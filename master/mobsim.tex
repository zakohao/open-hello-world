\documentclass[10.5pt]{jarticle}
\usepackage{amsmath}
\usepackage[dvips]{graphicx}

% Margins and Offsets
% 1in = 2.54cm
% Top Margins
%\voffset -10.4mm
%\hoffset 0pt
%\oddsidemargin -0.4mm
%\evensidemargin -15mm
%\setlength{\topmargin}{-.5cm}
%\headheight 0pt
%\headsep 0pt
%\columnsep 2zw
%\marginparsep 0pt
%\marginparwidth 13mm
%\footskip 15mm
% Contents area
% \setlength{\textheight}{24.5cm}%{24.5cm}
%\textheight 24.75cm
%\textwidth 51zw
%\baselineskip 0pt

\setlength{\textheight}{24.5cm}%{24.5cm}
\setlength{\textwidth}{16.0cm}%{16.5cm}
\setlength{\evensidemargin}{0cm}
\setlength{\headheight}{0cm}
\setlength{\topmargin}{-.5cm}
\setlength{\footskip}{1cm}
%\setlength{\footheight}{0.5cm}
\setlength{\oddsidemargin}{.5cm}

\title{移動体通信における性能評価のための\\都市空間を考慮した歩行モデルの構築}
\author{M2 金子雅志}

\begin{document}

\pagestyle{myheadings}

% \baselineskip 21pt
%\maketitle
%\thispagestyle{empty}
%\newpage

\tableofcontents

\subsection*{AppendixA　シミュレーションシステムについて}
\subsection*{AppendixB　性能評価データ（$ \lambda_p × 1.0 $ 再呼あり の場合）}
\newpage



\section*{概要}

携帯電話やPHS等の移動体通信システムは情報通信需要の高まりとともに、重要な生活産業基盤となっている。
移動体通信システムの重要な特徴としてサービスエリアに分布し、
個々が自由に移動する利用者に対して有限である無線の電波帯域を使ってサービスを提供することが挙げられる。
セルラー方式移動体通信システムの性能評価における多くの研究では、
確率過程を用いた数理的な研究と実データを用いたシミュレーションによる研究などが行われているが、
利用者の発呼や移動等の行動を単純化して扱っているものが多い。

本研究では、都市構造や、歩行者の混雑の影響を考慮した歩行モデルと
利用者の再呼を考慮した発呼行動モデルを構築し、
シミュレーションによって移動体通信システムの性能評価を行った。
開発したシミュレーターでは地図データや人口分布データ等の実データから
都市構造を考慮したセルラー方式システムの性能評価を行うことができる。
また、GUIによる直感的なインターフェースや視覚的に確認が容易な結果のグラフィカルな表示によって、
空間的なトラフィック量の分布や呼損の頻発箇所など、
セルラー方式システムにおける性能評価を容易に行うことができる環境を整備した。
東京都調布市を対象エリアとしたマイクロセルラー方式移動体通信システムの
性能評価をシミュレーションによって行った結果、
呼損率、人口の分布、移動している人の数など、
都市構造によってセルの性能にばらつきがみられ、
都市構造を考慮した各セルの状態の把握が必要であることを確認した。
また、駅周辺のような利用者の集団到着が発生するような場所では
呼の到着間隔や通話時間に指数分布を仮定したM/M/k/kモデルで見積もった呼損率と
シミュレーションによって計測された呼損率の間にずれがあることが確認された。

\newpage

\section{はじめに}

携帯電話の契約者数は既に8000万台を突破し、社会的なインフラとして認められるようになった。
i-modeやEZwebに代表されるような移動体端末からのデータ通信の需要も高い。
また、IMT-2000による高速データ通信や、
無線LANやPHS網を利用したIP電話など、
新たなサービスも次々と登場している。
そして、今後、ユビキタス社会が実現していく上で、
さらに移動体通信の需要が高まると思われる。

携帯電話や無線LANなどでは、有限な資源である周波数(チャネル)の有効利用が重要である。
現在は、セルラー方式が広く使われている。
セルラー方式では、端末と無線で交信するアンテナを分散配置し、
サービスエリアをセルと呼ばれる小エリアに分割する（図\ref{fig:CELLULAR}）。
移動体通信において、最も重要な問題はサービスエリア内に空間的に分布する
利用者に対してできるだけ均一なサービスを提供する事である。
セルラー方式では、一つのアンテナが同時に交信することができる端末の数は有限で、
利用者が多数存在するセルでは、チャネルの枯渇が発生しやすく、発呼が失敗(呼損)する可能性が高くなる。
つまり、利用者分布に極端な偏りのあるセル構成では、
呼損発生が生じやすく、システムの性能に対する評価は低くなる。
よって、セルの配置はできるだけは正確な
空間的なトラフィックの需要予測分析に基づいていることが望ましい。さらに移動体通信においては、
性能評価を行う際に利用者の分布だけでなく、
移動についても考慮する必要がある。
これは、携帯電話のような移動体通信サービスでは、
セル間をまたぐ移動が発生した場合、
ハンドオーバーによって行き先のセルに通話を引き継ぐためである。
ハンドオーバーの発生は、
呼の移動元のセルからみれば、通話が終了したときの呼の退去(終呼)と同等であり、
その端末が使用していたチャネルが開放される。
呼の移動先のセルからみれば、
ハンドオーバーしてくる呼(ハンドオーバー呼)は新規発呼の呼と同様に扱うことが出来る。
そのとき、空きチャネルが存在しない場合は、通話を持続することが出来ずに、
呼は強制切断される。
以上をまとめると、あるセル内での呼の発生と退去は
図\ref{fig:CALLTYPE}のように、4通り考えればよいことがわかる。
セルのサイズが小さくなればなるほど、
呼がセルをまたぐ頻度が大きくなるため、
ハンドオーバー呼の影響は大きくなる。

セルラー方式移動体通信システムの性能評価を行う従来の研究では、
確率過程を用いた数理的なモデルによるものや、
実際の地図データや人口分布データを用いて、
よりリアルな利用者の行動を表現するシミュレーションによる研究が行われてきた。
数理的なモデルによるものとして、\cite{SOFTHANDOFF} \cite{DOVE} では、
一つのセルに注目し、
利用されているチャネルの数の変動を待ち行列モデルによってモデル化し、
ハンドオーバー制御や、
チャネルの割当方式に新たな手法を取り入れたときの性能への影響を解析している。
\cite{FPA} は、
複数セルを同時に扱うことができる近似モデルを提案しており、
マルコフ連鎖の手法を用いて複数セル間の相互の影響を解析している。

数理的なモデルによって移動体通信の性能評価を行う研究では、
一つ、ないし複数のアンテナが有するチャネル数と
そのアンテナが構成するセル内に存在する利用者からのトラフィックについて、
チャネルをサーバーとし、
その利用率の確率分布から性能評価を行う研究が多く行われてきた。
ここでは、本論文でも呼損率見積もり比較のため採用したM/M/k/k待ち行列モデルを用いたものを簡単に説明する。
まず、一つのセルに対する呼は到着率 $ \lambda $ の指数分布に従うものとし以下のように表される。

\begin{equation}
\lambda = \lambda_f + \lambda_h
\end{equation}

{\noindent こ}こで、$ \lambda_f $ は新規発呼による呼の到着率であり、
$ \lambda_h $ はハンドオーバー呼の到着率であり、それぞれもまた指数分布に従う。

また、サービス率は平均 $ \mu $ の指数分布に従い、以下のようになる。

\begin{equation}
\mu = p_e \mu_e + ( 1 - p_e ) \mu_h
\end{equation}

{\noindent こ}こで、
$ p_e $ は呼があるセルから退去したときに、
その原因が終呼であるという割合で、
$ \mu_e $ はセル内で終呼する場合のサービス率であり、
$ \mu_h $ は移動してセル外へ出て行く場合のサービス率(セル内滞在時間の逆数)である。
新規発呼、ハンドオーバー呼の到着間隔がそれぞれ独立に指数分布に従うと仮定すると、
セルへの呼の到着間隔は率 $ \lambda $ の指数分布に従う。
また、セル内の通話時間が率 $ \mu $ の指数分布に従うと仮定する。
トラフィック密度 $ \rho = \displaystyle\frac{ \lambda }{ \mu } $
、チャネル数を $ k $ とするとM/M/k/k待ち行列モデルでの呼損率 $ p_b $ は、

\begin{equation}
p_b = \frac{ \displaystyle\frac{ \rho^k }{ k! } }{ \displaystyle \sum_{i=0}^k{ \frac{ \rho^i }{ i! } }  } 
\end{equation}

{\noindent と}なる。
\cite{SOFTHANDOFF} \cite{DOVE} \cite{FPA} や、その他の多くの解析的なモデルでは、
性能評価に待ち行列モデルやマルコフ連鎖などの確率過程による解析を行っているため、
上記のM/M/k/kによるシンプルな例と同様に、
呼の発生や、セル内滞在時間の分布などに、ポアソン到着や指数分布を仮定している。

しかし、現実の都市空間を考えると、
電車から利用者が集団で到着したり、
信号によって人の往来に周期性が生まれたり、
道の混雑などによって人の滞留が起こったりと、
呼の到着や通話時間にポアソン到着や指数分布などを仮定した性能評価と現実の間にずれが生じる可能性がある。
また、現実的な携帯電話の使われ方から考えると、
呼損や通話の強制切断時には再呼を試みると考えるのが自然であり、
その再呼の影響を考慮した場合、
M/M/k/kのような単純なモデルとでは
性能評価に差が生まれることも考えられる。
このような実際に近い状況を解析的に求める事はたいへん難しく、
特に再呼や道路に沿った移動を取り込んだ研究は筆者の知る限りほとんどない。

シミュレーションによる研究では、
\cite{KURT} のように、
実際の人口分布データや交通量データからトラフィックの空間的な分布を表現するものや、
\cite{VTT} のように、
実際の地図データを用いて、
都市構造を考慮した利用者の移動を表現するものなどがあるが、
利用者の行動は単純化されており、
利用者の移動や到着の様子に注目した研究はあまり行われていないようである。

そこで、本研究では、都市空間を考慮した人の分布や往来と、
再呼の影響を考慮したトラフィック行動を表現するモデルを提案する。
そして、そのモデルに基づいて、
都市空間や人口分布の表現に実際のデータを用い、
様々な状況を扱える汎用的なシミュレーションシステムを開発し、
移動体通信システムの性能評価を行う。

本論文は次のように構成される。
第2節では利用者行動を考慮したシミュレーションモデルについて説明し、
第3節にシミュレーションモデルを実現するシミュレーションシステムについて説明する。
第4節ではシミュレーションによって得られた結果について考察する。
第5節ではまとめと今後の課題を述べる。
\\
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.3}{\includegraphics{CELLULAR.eps}}
 \caption{セルラー方式移動体通信システム概要図}
 \label{fig:CELLULAR}
\end{center}
\end{figure}
\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{0}{\scalebox{0.6}{\includegraphics{CALLTYPE.eps}}}
 \caption{一つのセルに注目したときの呼の発生と退去}
 \label{fig:CALLTYPE}
\end{center}
\end{figure}
\end{center}
%
%


\section{利用者行動モデル} 

\subsection{利用者行動の表現} 

移動体通信システムの性能評価では 
呼の空間的な分布や移動によるハンドオーバーを考慮する必要がある。
性能評価に関する先行研究の多くは、 
利用者の発生にポアソン到着、セル内滞在時間に指数分布を仮定するなど、呼の発生や通話中の移動 
などの利用者の行動に単純なランダムネスを仮定している。
一方、現実の移動体通信システムでは、例えば駅付近では利用者が電車の到着や
信号、また過度に混雑した道路での人の滞留などによって
集団到着したり到着に周期性が生じたり、一つのセルに滞在する時間が長くなる、
といった現象が想定され、これらがトラフィックの確率的振る舞いに大きく影響する可能性がある。
そのため、呼の発生に指数分布などの単純な到着分布を仮定すると性能評価においてずれが生じる可能性がある。

現実の街での人の流れをみると、個人個人の目的を持った行動の積み重ねが 街中の人の流れとなっている。
そこで本研究では、対象とするシミュレーションエリア内における歩行者
(シミュレーション時間内で移動体通信を利用する人もそうでない人も含む)
の典型的な歩行行動パターンをいくつか用意し、その重ね合わせで歩行者行動を表現することを考える。 
シミュレーションではこれらの歩行行動パターンに従った歩行者が発生し、 
歩行者のうち幾人かが発呼を行うことによって移動体通信システムの性能評価のための利用者の分布と移動を実現する。 
ここでは一つの歩行行動パターンを歩行者行動の「型」と呼び、以下の特徴から構成される。
本モデルでは、OD(Origin Destination)ペアの選択および発生の様子によって型毎の発生・歩行行動パターンを設定する。
%
\begin{eqnarray} 
\mbox{OD}ペアの選択 &：& 発生地点と移動先地点 \nonumber \\ 
発生の様子 &：& ポアソン到着・集団到着・定期的な到着 \nonumber \\ 
歩行の特徴 &：& 目的地に向かって急いでいる・回遊している \nonumber
\end{eqnarray} 
%
{\noindent な}お本研究では 
駅周辺の数キロメートル四方の比較的狭いエリアを対象としているので
自動車や電車に乗っている利用者は対象から除外し、
利用者として歩行者のみを想定している。

以下ではベースとなる都市空間をモデル化し、
都市空間内における歩行者の発生や移動先地点の与え方や経路選択、
再呼も含めた発呼行動などの個人レベルの行動をモデル化する。
また歩行者が狭いエリアに集中することによって引き起こされる混雑現象をモデル化する。


\subsection{都市構造に基づく利用者の発生と移動}

本モデルでは歩道のネットワークを無向グラフで表し、 
歩行者はこのグラフのエッジに沿って移動を行う。 
%幹線道路等において歩道が車道の両側にあるような場合は
%図\ref{fig:MAPGRAPHEXP}のように2本のエッジで表現する。 
さらに歩行者の混雑や滞留も表現するために、 
信号や踏切など、歩行者の移動に影響するような要素と制御情報等も都市構造としてモデルにとりいれた。

歩行者の発生だけではなく、 
歩行者の型に従った目的地も選択しなければならないが、ここでは 
目的地はある確率分布に従って選択されるものとする。 
目的地の分布は例えば、朝の自宅から駅に向かって徒歩で移動するような歩行者を考えるならば、 
その歩行者の移動経路の始点は 
その駅の徒歩圏エリアの住宅人口分布に従って発生させ、終点は駅に向かう歩行者なので、 
目指す目的地の空間的な分布は、 
駅のホーム上に集中した分布となる。 


\subsubsection{都市構造のモデル化}

人の移動モデルに関する研究において、
地図データをラスター形式で扱うものと、
ベクトル形式で扱うものがあるが、
本モデルではベクトル形式で扱う。

本研究で扱うモデルでは、
道路ネットワークを無向グラフ構造で表すことによって、都市構造を表現している。
つまり、

\begin{equation}
{\bf N} = \{ n_0 , n_1 , ... , n_N \}
\end{equation}

{\noindent と}いう2次元平面上の点(ノード)の集合と、
それらのノードをつなぐエッジの集合で表す。
ノード間の直接距離を表す距離行列 {\bf D }を以下のように定める。

\begin{displaymath}
{\bf D} =
\left (
\begin{array}{cccc}
0       & d_{0 1} & \cdots & d_{0 N}\\
0       & 0       & \cdots & d_{1 N}\\
\vdots  & \vdots  & \ddots & \vdots \\
0       & 0       & \cdots & 0      \\
\end{array}
\right )
\end{displaymath}

ここで、$ d_{i j} $ は $ e_{i j} $ の距離であり、
$ n_i $ と $ n_j $ を直接つなぐエッジが存在しない場合、
$ d_{i j} = -1 $ となる。
下三角要素は保持する必要がないため $ 0 $ としている。
エッジの両端のノードの対の集合を {\bf E} とする。

\begin{equation}
{\bf E} = \{ (i,j) : d_{ij} > 0 ~ , ~ i > j \} \nonumber
\end{equation}

\begin{equation}
e_{ij} = (属性値：w_{i j}, 道路のタイプ) ~~ (i,j) \in {\bf E} \nonumber
\end{equation}

また、エッジ $ e_{i j} $ は属性値として以下の情報を持つ。

\begin{enumerate}
\item エッジの幅(道幅) $ w_{i j}$
\item 道路のタイプ(歩道、信号、スクランブル交差点、踏切等)
\end{enumerate}

{\noindent 本}モデルでは、
利用者の歩行が信号や踏切によって制御されるなど、
行動に対する都市構造の影響を考慮するため、
このような属性値が必要となる。

例として、上記のグラフ構造によって調布駅の徒歩利用圏を表したものを図\ref{fig:CHOFUMAP}に示す。
%
%
\begin{figure}
\begin{center}
 \begin{tabular}{c c}
 \scalebox{0.5}{\includegraphics{CHOFUMAP.eps}}
 　　
 \scalebox{0.52}{\includegraphics{CHOFUGRAPH.eps}}
 \end{tabular}
\end{center}
 \caption{調布駅周辺徒歩通勤圏の地図（左）とグラフ構造で表したもの（右）}
 \label{fig:CHOFUMAP}
\end{figure}
%
%
本モデルでは、歩行者の移動を扱っているため、
グラフ構造も歩行者が通行する道を表現する必要がある。
よって、国道や県道など、一本の道であっても歩道と車道が分かれているような道路は
図\ref{fig:MAPGRAPHEXP}のように2本のエッジで表現される。
%
%
\begin{figure}
\begin{center}
 \begin{tabular}{c c}
 \scalebox{0.25}{\includegraphics{MAPGRAPHEXPA.eps}}
 　　
 \scalebox{0.32}{\includegraphics{MAPGRAPHEXPB.eps}}
 \end{tabular}
\end{center}
 \caption{元の地図データとグラフ構造データ}
 \label{fig:MAPGRAPHEXP}
\end{figure}
%
%
\subsubsection{人口分布データと型によるODペアの生成}

本節では、利用者の発生地点や、
移動先の目的地を示す点など、
空間的な点の分布の扱いについて説明する。

移動体通信システムでは、利用者は空間的に不均一に分布するため、
よって、複数セルの依存関係などを調べたい場合に、
その分布を考慮することは重要である。
\cite{KURT}では、人口分布メッシュデータから
利用者の空間的な分布を生成している。
\cite{VTT}では、
移動する利用者の初期配置を
駅周辺などの都心部に集中させることで分布の不均一さを表現している。

本モデルにおける「型」は、
「どこで発生して」「どこへ向かうのか」というODペア選択の違いで特徴付けされ、
発生の分布と発生後の移動で利用者の
空間的な分布不均一を表現する。
そのため、本モデルでは、利用者の発生だけではなく、
利用者のタイプに従った目的地の分布を発生させる必要がある。
例えば、目的地の分布について考えると、
朝、駅から目的地に徒歩で移動するような利用者が目指す目的地の空間的な分布は
その駅の徒歩圏の昼間人口分布に従うと考える。
また、朝、自宅から駅に向かう利用者が目指す目的地の空間的な分布は、
簡単化のため利用者が電車に乗った瞬間にシミュレーションエリアから退去すると考えると、
駅のホーム上に集中した分布であると考える。
このように、本モデルでは、
数キロ四方に広がる人口分布や、
駅など、ある施設に集中した分布など、
異なったスケールの分布を扱う必要がある。
本モデルにおいて、
分布はメッシュの形状で表すが、
上記の事項を実現するために、粒度の異なるメッシュを扱えるようにする必要がある。

例として、朝に調布駅を利用する通勤客のODペアを考えよう。
通勤客は自宅から駅に向かうため、
始点は住宅人口分布(図\ref{fig:CHOFUMESH}(a))に従い発生する。
そして、終点の分布は駅のホーム上(図\ref{fig:CHOFUMESH}(b))となる。
図\ref{fig:CHOFUMESH}で示したように、
広いエリアである調布駅の徒歩圏の人口分布や、
狭いエリアである調布駅のホーム上の領域など、
利用者行動の特徴によって分布を決定する必要がある。

本モデルにおいては、
利用者の行動をシミュレーション上で表現する際に空間的なODペアの分布データが必要になるが、
よって、シミュレーションエリアにあたり、
それらのデータが妥当性を持つように配慮する。
本論文では調布駅の徒歩利用圏をシミュレーション対象エリアとし、
分布のメッシュデータは国勢調査の町丁別人口分布データから作成している。
そして、エリア外から調布駅に向かってくる利用者や
エリア外に向かう利用者の発生はないものとしている。
調布駅に向かう利用者と調布駅から目的地に向かう
ほとんどの利用者のODペアの分布が徒歩利用圏エリア内で閉じていると考えられ、
対象エリアの居住人口分布をODペアの分布データに取り入れることで十分であろう。
もし、ODペアの分布がエリア内で閉じていない場合は、
エリアから出て行く利用者と外部から入ってくる利用者を考慮する必要があり、
結果として分布が複雑になりすぎて、信憑性のある分布データを構成するのが難しくなってしまうため、
注意が必要である。
%
%
\begin{figure}
\begin{center}
 \begin{tabular}{c c}
  \rotatebox{0}{\scalebox{0.4}{\includegraphics{CHOFUMESHA.eps}}} &
  \rotatebox{0}{\scalebox{0.4}{\includegraphics{CHOFUMESHB.eps}}} \\
  
  (a) 調布駅周辺夜間人口分布 &
  (b) 調布駅の分布 \\
 \end{tabular}
\end{center}
 \caption{ODペアの発生分布の例}
 \label{fig:CHOFUMESH}
\end{figure}
%
%

\subsection{混雑時の影響を考慮した歩行モデル}

現実の都市空間では、
空いている道路と混雑している道路では
歩行速度に差が出る。
さらに、信号待ちの混雑や駅の改札口に人が集中した場合など、
歩行者が滞留を起こすことがある。
移動体通信システムにおいて歩行者の滞留はセル内滞在時間を長くし、
結果的に一つのセルにおけるサービス時間を長くする。
本モデルにおいてはこの影響も考慮するため、
混雑や滞留を表現することができる歩行モデルを構築した。

本モデルにおける歩行モデルはグラフ構造で表現された道路上を移動するグラフベース歩行モデルであり、
同じ道路上(同一エッジ上)を移動する利用者は同一直線上を移動する。
同一道路上を移動する利用者同士に左右の差はなく、
ノード$ n_i $ とノード $ n_j $ を結ぶエッジ上の歩行者の歩行速度の方向ベクトルは、
$ \overrightarrow{ n_i n_j } $ か $ \overrightarrow{ n_j n_i } $ となる。
これは、本モデルにおける混雑現象は
\cite{MAGNET}のように衝突や回避といった2次元平面上の運動として扱うようなミクロレベルのものではない。
本歩行モデルにおいて混雑や回避などの影響は、
周囲の状況から自分の歩行の妨げとなる要素を抽出し、
それらを元に歩行に対する妨げの度合いを計算し、
歩行速度に反映させることによって実現した。


\subsubsection{歩行モデル概要}

一般に、歩行者の挙動を扱うモデルについては、
一本の道路や建物の1フロアのレベルで歩行者同士のすれ違い時の回避行動や
混雑時の人の流れをミクロレベルで扱うものや、
一つの街など、広い範囲での人の流れを扱うマクロレベルのものがある。
本研究で扱うモデルは比較的広い範囲の移動体通信システムの評価を目的に構築したので、
上記のモデルよりはマクロなレベルの人の流れを扱うモデルとなる。
また、都市構造をグラフ構造で表現しているため、
歩行者がグラフ上を移動するグラフベース歩行モデルを採用した。
グラフベース歩行モデルでは、
都市空間における歩道のネットワークを無向グラフで表現し、
歩行者はそのグラフ上を移動する。

筆者は、歩行者の観察によって次のような歩行行動の特徴に気付いた。\\

\begin{enumerate}
\item 歩行者の歩行速度は周囲の歩行者の流れに影響を受け、一般的に混雑時には歩行速度は遅くなる。
\item 道幅が広ければ他の歩行者が歩行速度に与える影響は少なくなる。
\item 混雑していた場合でも、各自の歩行者の歩行方向への流れがよい場合には影響は少ない。
\item 近くにいる歩行者から受ける影響は大きく、遠くにいる歩行者は気にしていない。
\item 他の歩行者が同方向に歩行している場合、自分よりも歩行速度が速い歩行者は妨げにならない。
\item 他の歩行者が他方向に歩行している場合、自分との相対速度が自分の進行方向と逆方向に大きければ大きいほど妨げとなる。
\item 視界に入っていない歩行者から受ける歩行速度への影響は少ない。
\item 対面方向から向かってくる歩行者とは互いによけあうため、比較的妨げにならない。
\item 極端に混雑している場合でも、完全に停止することはない。
\end{enumerate}

{\noindent 本}歩行モデルでは上記の歩行行動の特徴に基づいて、
歩行者同士がお互いの歩行行動を妨げる度合いを計算し、
その値によって歩行速度を変化させた。
歩行速度の更新は、微小時間間隔毎に行われる。

ある歩行者に注目したとき、
その歩行者の歩行速度に影響を与えるのは
視界に入っている他の歩行者である。
他の歩行者から受ける影響の大きさは、
相手との距離、相手の速度の向きと大きさ、
相手の移動方向と自分の移動方向から計算される。
本モデルでは一人の他の歩行者からうける上記の影響の度合いをその歩行者からの妨げ値と定義し、
この影響を視界に入っている全ての歩行者について計算し、
その総和を総妨げ値と定義する。
つまり、総妨げ値とは、
ある瞬間において、ある歩行者が周囲の環境からうける
歩行への障害を表す値であり、
それを自分が理想としている歩行速度から減じたものを次の瞬間の歩行速度とする。
例えば、歩行者Aの視界に歩行者B一人が存在した場合、
妨げ値と歩行速度の関係は図\ref{fig:PEDMODEL1}のようになる。
妨げの値が比較的大きかった場合など、
単純に減ずるだけでは歩行者が停止・後退してしまう可能性があり、
上記の9番目の特徴に反する。
よって、最低歩行速度をあらかじめ指定しておき、
それを下回る場合は、最低歩行速度を歩行速度とする。
また、相対速度だけで妨げの度合いを表すと、
上記8番目の特徴に反し、
正面から向かってくる他者からの影響が非常に大きくなってしまう。
現実の歩行者を考えると、
群衆の中で歩行する歩行者は歩行流\cite{OKADA}を形成し、
対面から接近してくる他者とは互いに避けあい、歩行に与える影響が少ない。
自分の正面を自分と同方向に遅い速度で歩行している歩行者から受ける影響のほうが大きい。
本モデルでは、これらの性質を考慮するため、
他の歩行者との向き合っている角度によって妨げの度合いを調整し(回避影響と呼ぶ)、
お互いを認識している他者からの影響を軽減している。

本歩行モデルで使用するパラメータを以下に示す。

\begin{center}
	\begin{tabular}{lcl}
	$ {\bf V}   $ & : & 歩行速度ベクトル \\
	$ {\bf V_i} $ & : & 理想歩行速度ベクトル \\
	$ v_{min}   $ & : & 最低歩行速度 \\
	$ r         $ & : & 注意視界半径 \\
	$ \theta    $ & : & 注意視界角度 \\
	$ k_r       $ & : & 妨げ定数 \\
	$ k_a       $ & : & 回避影響定数 \\
	\end{tabular}
\end{center}

\begin{itemize}

\item 歩行速度ベクトル \\
実際に歩行した歩行速度ベクトル。
他の歩行者からの影響を受け、歩行速度を調整した結果として計算される。

\item 理想歩行速度ベクトル \\
周囲に歩行の妨げとなる要素が全く存在しない場合の歩行速度ベクトル。

\item 最低歩行速度 \\
どんなに周囲が混雑していても最低限進むことが出来る歩行速度。

\item 視界半径 \\
妨げとなる歩行者を探索する扇形状空間の半径。

\item 視界角度 \\
妨げとなる歩行者を探索する扇形状空間の角度。

\item 妨げ定数 \\
妨げの総和にかかる定数。

\item 回避影響定数 \\
回避行動による妨げ解消を調整する定数。

\end{itemize}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{0}{\scalebox{0.4}{\includegraphics{PEDMODEL1.eps}}}
 \caption{本歩行モデル概要図}
 \label{fig:PEDMODEL1}
\end{center}
\end{figure}
\end{center}
%
%

\subsubsection{妨げ値・歩行速度の計算}

本歩行モデルにおいてある歩行者の歩行速度に影響を与えるのは 
視界に入っている他の歩行者である。
他の一人の歩行者から受ける妨げ値の大きさは、
図\ref{fig:PEDMODEL1}のように
相手との距離、相手との相対速度の向きと大きさ、
相手の移動方向と自分の移動方向から計算する。
歩行者 $A$ が歩行者 $B$ から
受ける妨げ値 $ r_{AB} $ は、
%
\begin{equation}
r_{AB} = s_{AB} t_{AB} \label{eq:rab}
\end{equation}
%
{\noindent と}なる。
ここで $ t_{AB} $ は相手との相対速度から計算される妨げ値で、歩行者 $B$ の速度 ${\bf V_B}$ および
歩行者 $A$ が他の歩行者から全く支障を受けずに歩くことができたときの仮想的な速度 ${\bf V_i}$ 
(歩行者 $A$ の理想歩行ベクトルと呼ぶ)によって以下で与えられる。
%
\begin{equation}
t_{AB} = \displaystyle\frac{ ( {\bf V_{B} } - {\bf V_{i} } ) \cdot {\bf Vi} } { |{\bf Vi}| }. \label{eq:rv}
\end{equation}
%
$ s_{AB} $ は相対速度以外の要素から計算される妨げ値に対する修正値で、
歩行者 $A$ と $B$ の距離 $d_{AB}$、対峙角度 $\theta_{AB}$、および歩行者 $A$ が歩行しているエッジの道幅 $w_{A}$ によって以下の式で与えられる。
%
\begin{equation}
s_{AB} = \displaystyle\frac{ 1 - \displaystyle\frac{ ( 1 - \cos \theta_{AB} ) k_a } { 2 } } { w_{A} ( 1 + d_{AB} )^3 }. \label{eq:rm}
\end{equation}
%
ここで $k_a$ は回避行動の影響を調整する定数である。
歩行者 $A$ と歩行者 $B$ がお互いに正面を向いているときは、
回避の影響によって $ s_{AB} $ が最小となり、
歩行者 $B$ を歩行者 $A$ が追従するような場合は回避の影響はなくなるため、
$ s_{AB} $ が最大となる。
歩行者 $A$ が周囲の歩行者から受ける妨げ値の合計 $ R_A $ は
\begin{equation}
R_A = \sum_{ p ~ \in ~ {\bf P_A } } k_{R} \cdot { r_{Ap} }
\end{equation}
\noindent
とする。
$ k_R $ は妨げ値が歩行速度に与える影響の大きさを調整する定数である。
妨げ値 $ R_A $ は歩行者 $ A $ の注意視界に入っている歩行者の集合 $ {\bf P_A } $ である。
注意視界とは歩行の妨げとなる他の歩行者を探索する範囲であり、
図\ref{fig:PEDMODEL1} に示すように左右の角度と距離で設定される扇形の領域である。
含まれる歩行者毎に個別の妨げ値 $r_{Ap}$ を(\ref{eq:rab})で計算することに
よって得られる。

歩行者の速さ $ | {\bf V_A } | $ は理想の歩行の速さから妨げ値を加算したものである。
ただし過度に混雑している場合でも最低歩行速度 $ v_{min} $ よりも下回らないと仮定し、
以下で与えられる。
\begin{eqnarray} 
| {\bf V_A } | = \mbox{ max }( ~ |{\bf Vi}| + R_A ,v_{min} ~ ).
\end{eqnarray} 


\subsubsection{歩行モデルの実験}

本歩行モデルに基づいた歩行行動の様子を簡単なシミュレーション結果を用いて説明する。
この実験における歩行に関するパラメータは
歩行速度$V$と歩行者人口密度$K$の関係を表す$KV$直線\cite{OKADA}との比較と
様々なパラメータを設定し実験した結果より表\ref{fig:PEDMODELPARAM}のように設定し、
全ての歩行者は同じパラメータに従っている。

ここで説明に用いる簡易シミュレータはあらかじめ歩行経路と発生量を指定し実行すると、
本歩行モデルによって速度計算を行いながら経路に沿って移動する利用者が発生し、
視覚的に表示することによって歩行者の滞留の様子などを観察することができるものである。
図中の点が一人の歩行者を表していて、
色の濃淡が濃いものは他者の妨げによって歩行速度が低下していることを表している。

まず、図\ref{fig:PEDMODELTEST1}では、
二つの道から合流する歩行者の様子を示している。
図中の左側から発生した歩行者は合流地点に向かって移動し、合流後に右方向に抜けていく。
図を見ると、合流地点に近づくほど歩行速度が遅くなり、
混雑が発生していることが観察できる。

図\ref{fig:PEDMODELTEST2}では、
赤信号で歩行者が信号付近に溜まっている様子を示している。
図中の左側から発生した歩行者は右側に移動するが、
途中の赤信号で他の歩行者が滞留しているため、
信号に近づくほど歩行速度が低下している。

図\ref{fig:PEDMODELTEST3}では、
8方向からスクランブル交差点に向かう歩行者の流れを示している。
この図では、歩行者の密度が疎なところでは歩行速度の低下が見られないが、
スクランブル交差点の中心のように、
歩行者が激しくすれ違ったり交差したりする場所では
他の歩行者からの妨げ値が大きくなることから、
歩行速度の低下が見られることを示している。
%
%
\begin{table}
\begin{center}
\caption{実験における歩行に関するパラメータ}
\begin{tabular}{|l|r|} \hline
	理想歩行速度 & 1.35 \\\hline
	最低歩行速度 & 0.3 \\\hline
	注意視界半径(m) & 3 \\\hline
	注意視界角度($ ^\circ $) & 30 \\\hline
	妨げ定数 & 3.6 \\\hline
	回避影響定数 & 0.8 \\\hline
\end{tabular}
\end{center}
\label{fig:PEDMODELPARAM}
\end{table}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{270}{\scalebox{0.4}{\includegraphics{PEDMODELTEST1.eps}}}
 \caption{歩行モデルシミュレーション例：合流地点}
 \label{fig:PEDMODELTEST1}
\end{center}
\end{figure}
\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{270}{\scalebox{0.3}{\includegraphics{PEDMODELTEST2.eps}}}
 \caption{歩行モデルシミュレーション例：信号}
 \label{fig:PEDMODELTEST2}
\end{center}
\end{figure}
\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{0}{\scalebox{0.4}{\includegraphics{PEDMODELTEST3.eps}}}
 \caption{歩行モデルシミュレーション例：スクランブル交差点}
 \label{fig:PEDMODELTEST3}
\end{center}
\end{figure}
\end{center}
%
%

\subsection{経路選択モデル}

本歩行モデルは、グラフベース歩行モデルであり、
歩行者はグラフ構造で表された都市空間をエッジに沿って移動する。
利用者はODペアに従ってグラフ上を目的地に向かって移動するが、
交差点や、分岐点に差し掛かるたびに、
次の経路を選択しなければならない。
本モデルでは様々な経路探索手法で試行錯誤を行った結果、
次のような理由から経路選択にロジットモデル\cite{ROGIT}を採用した。

都市構造に従った移動を行うモデルで、経路選択を扱っている\cite{VTT}では、
利用者が交差点に差し掛かったときに、
次の経路を単純に道幅によって確率的に選択する方法や、
目的地を設定し、その目的地への向きにより近いものを確率的に選択する方法が紹介されている。
しかし、これらの単純な経路選択方法では、
必ずしも歩行者が目的地に到着するとは限らず、
都市構造に従って利用者が集中したり分散したりする様子を的確に表現しているとは言い難い。
また、利用者が集団で大量に到着して、
各々の目的地に向かうような様子を表現するためには、
歩行者が道路の構造によって目的地になかなかたどり着けずに街を徘徊する可能性があるような経路選択モデルは、
適さないと判断した。

次に目的地に必ず到着させるためには、
現在地から目的地までの経路を探索し、
それに基づいた経路選択を行う必要がある。
また、目的地が決まった場合、特別な意志が働かない限り、
なるべく歩く距離が短い経路を選択すると思われるため、
経路選択は最短距離の経路選択に基づいている必要がある。
しかし、一般的に、最短経路の経路探索は多くの計算量を必要とするため、
大勢の歩行者を扱うためには、シミュレーション実行時の計算量を削減するようなしくみが必要である
ことがいくつかの予備実験からわかった。
また、ただ単純に最短経路を移動させる選択方法では、
目的地に対してはどちらも同じような距離の経路が複数存在した場合でも、
特定の道だけに人が集中してしまい、結果としてあまり現実的でない歩行流となってしまった。

そこで本モデルでは、最短経路探索をベースにしながら、
経路選択に利用者行動の特徴を表現できるようなモデルとして
経路選択に以下に述べる手続きで
ロジットモデル\cite{ROGIT}を導入し、比較的軽い計算負荷で多様な歩行流を実現した。


\subsubsection{最短経路探索}

ここでは、最短経路の探索方法について説明する。
シミュレーション実行時に各々のODペアに対して最短経路を逐次計算していたのでは
計算量が多すぎて多人数の利用者を扱うことができない。
よって本モデルでは、ダイクストラ法によって
あらかじめ各ノード間の最短経路を通ったときの距離を計算しておき、
その結果を用いて経路選択を行う。

まず、ノード間の最短経路距離情報を
以下のような行列 $ {\bf \widehat{ D } } $ に
あらかじめ計算しておき、保持しておく。


\begin{displaymath}
{\bf \widehat{ D } } =
\left (
\begin{array}{cccc}
0                & \hat { d }_{0 1} & \cdots & \hat { d }_{0 N} \\
0                & 0                & \cdots & \hat { d }_{1 N} \\
\vdots           & \vdots           & \ddots & \vdots \\
0                & 0                & \cdots & 0      \\
\end{array}
\right )
\end{displaymath}


{\noindent こ}こで、$ \hat { d }_{i j} $ は最短経路を通ったときの
ノード $ n_i $ , $ n_j $ 間の距離である。
下三角要素は保持する必要がないため $ 0 $ としている。
ノード $ n_i $ から $ n_j ~ ( i \neq j ) $ を最短経路で目指す場合、
次に向かうべきノードは $ ( \hat{ d }_{i j} - \hat{ d }_{k j} ) = d_{i k} $ となるようなノード $ n_k $ である。

しかし、本モデルでは、利用者のODペアが必ずしもノード上に発生するとは限らないため、
ノード間の最短経路だけを求めるだけでは不十分である。
ODペアの始点を $ p_O $、終点を $ p_D $ としたとき、
経路の選択手順は(a)ノード以外の位置での選択と(b)ノード上での選択に分けられ、
以下の通りになる。


\subsubsection*{(a)ノード以外の位置での経路選択}

経路の始点 $ p_O $ がエッジ $ e_{i j} $ 上となった場合、
終点も $ e_{i j} $ に存在するならば終点に直接移動するが、
そうでない場合は、次に移動する方向を、
$ e_{i j} $ が接続するノード $ n_i $ か $ n_j $ から選択する必要がある。
$ e_{i j} $ 上の点 $ p_O $ から $ e_{k l} $ 上の点 $ p_D $ に最短経路で向かう場合、
図\ref{fig:ROUTING1} で示したように $ n_i $ と $ n_j $ を経由した最短経路の候補としては、
4種類の経路候補があるため、最短経路を得るためには、
以下のような4種類の経路の距離を計算する必要がある。\\

\begin{description}
\item{経路1} \\
$ p_O $ から $ n_i , n_k $ 経由で $ p_D $ へ向かう経路
\item{経路2} \\
$ p_O $ から $ n_i , n_l $ 経由で $ p_D $ へ向かう経路
\item{経路3} \\
$ p_O $ から $ n_j , n_k $ 経由で $ p_D $ へ向かう経路
\item{経路4} \\
$ p_O $ から $ n_j , n_l $ 経由で $ p_D $ へ向かう経路
\end{description}

{\noindent こ}こで、点 $ p_O $ からノード $ n_i , n_k $ 経由で
点 $ p_D $ まで向かう最短経路の距離 $ \delta_{i k} $ は以下のようになる。

\begin{equation}
\delta_{ i k } = | \overrightarrow{ p_O n_i } | + min( \hat{ d }_{ i k } + | \overrightarrow{ n_k p_D } | , \hat{ d }_{ i l } + | \overrightarrow{ n_l p_D } | )
\end{equation}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.4}{\includegraphics{ROUTING1.eps}}
 \caption{ODペア( $ p_O , p_D $ )間の最短経路候補}
 \label{fig:ROUTING1}
\end{center}
\end{figure}
\end{center}
%
%


\subsubsection*{(b)ノード上での経路選択}

利用者がノード $ n_i $ に到達したときの経路選択について説明する。
$ e_{i j} $ 上の点 $ p_{now} = n_i $ から $ e_{k l} $ 上の点 $ p_D $ に最短経路で向かう場合、
$ n_i $ が $ e_{k l} $ と接続しているならば
$ p_{now} $ から $ p_D $ に直接向かうことができるが、
そうでない場合は
$ n_i $ が接続している他のノードから次に向かうべきノードを選択する必要がある。
$ n_i $ が他の $ X $ 本のエッジと接続されている場合、
直前に通ってきたエッジは除外されるため、
選択の候補としては$ e_{i x_1} , e_{i x_2} , ... , e_{i x_{X-1}} $ という$ X-1 $ 個のエッジから選択することになる。
その中からあるエッジ $ e_m $ を選択したとき、
その $ e_m $ を通ってエッジ $ e_{k l} $ 上の $ p_D $ まで移動する最短経路の距離 $ \hat{ \delta }_{i m} $ は、
以下のように表される。

\begin{equation}
\hat{ \delta }_{ i m } = d_{i m} + min( \hat{ d }_{ m k } + | \overrightarrow{ n_k p_D } | , \hat{ d }_{ m l } + | \overrightarrow{ n_l p_D } | ) \label{eq:deltahat}
\end{equation}

{\noindent こ}こで、$ \hat{ \delta }_{i m} $ を計算するためには2通りの経路を計算する必要があり、
$ X-1 $ 個の選択肢があった場合は、
図\ref{fig:ROUTING2}で示すように、
$ 2(X-1) $ 通りの経路について計算する必要があるが、
$ d_{ij} , \hat{ d }_{m k} $ はあらかじめ計算されているため、
シミュレーション実行時の計算量は少ない。\\

\begin{description}
\item{経路1} \\
$ n_i $ から $ n_{x_1} , n_k $ 経由で $ p_D $ へ向かう経路
\item{経路2} \\
$ n_i $ から $ n_{x_1} , n_l $ 経由で $ p_D $ へ向かう経路
\item{経路3} \\
$ n_i $ から $ n_{x_2} , n_k $ 経由で $ p_D $ へ向かう経路
\item{経路4} \\
$ n_i $ から $ n_{x_2} , n_l $ 経由で $ p_D $ へ向かう経路\\
$ \vdots $
\item{経路$ 2(X-1)-1 $} \\
$ n_i $ から $ n_{x_{X-1}} , n_k $ 経由で $ p_D $ へ向かう経路
\item{経路$ 2(X-1) $} \\
$ n_i $ から $ n_{x_{X-1}} , n_l $ 経由で $ p_D $ へ向かう経路
\end{description}

{\noindent そ}して、$ \hat{ \delta }_{i m} $ が最小となるようなエッジ $ e_{i m} $ を
選択していけばその経路が最短経路となる。

図\ref{fig:ROUTING5}は上記の最短経路探索手法を実際の地図データ上で実行したものである。
調布駅の通勤圏をグラフ構造で表すとおよそ2000ノードとそれらをつなぐ2500本のエッジが必要になる。
このような大きい規模のデータであっても、
$ {\bf \widehat{ D } } $ をあらかじめ計算しておくことによって、
多数の利用者が各々の経路選択を最短経路探索によって行った場合でも、
計算量を抑えることができる。
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.4}{\includegraphics{ROUTING2.eps}}
 \caption{ $ n_i $ から $ p_D $ までの最短経路候補 }
 \label{fig:ROUTING2}
\end{center}
\end{figure}
\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{0}{\scalebox{0.5}{\includegraphics{ROUTING5.eps}}}
 \caption{ 実際の地図データ上での最短経路探索(調布駅→日活撮影所) }
 \label{fig:ROUTING5}
\end{center}
\end{figure}
\end{center}
%
%


\subsubsection{ロジットモデルによる経路選択}

本モデルにおいて、
経路選択はその経路を通った場合に目的地までどれだけ接近できるかという度合いをもとに行われる。
上記(a)(b)の手順によって、
ODペア間の最短経路探索は実現することができる。
ここで、図\ref{fig:ROUTING3}のように、
途中に分岐と合流があるような経路を考える。
最短経路選択のみで経路選択を行うと、
図\ref{fig:ROUTING3}(a)のように、
少しでも道のりが短い経路を選択するため、
上側の経路に人が集中する。
しかし、直感的には、似たような距離の経路ならば、
図\ref{fig:ROUTING3}(b)のように、
歩行者の経路選択は分散すると考えられる。
選択経路の分散は、
その距離の差が大きくなればなるほど偏りは大きくなり、
逆に、全く同じ距離の経路が2本存在する場合は、それらの経路の選択確率は等しいと考えられる。

本モデルでは、上記の問題点を解決するために、
最短経路だけを選択するのではなく、
ロジットモデルによって
選択確率を経路距離の差によって重み付する経路選択モデルを構築した。

ロジットモデルによる選択モデルは、
選択の基準となる値とその値の差に対する敏感さによって
それぞれの選択肢の選択確率を決定するモデルである。
$ K $ 個の選択肢の集合 $ {\bf E_K } $ があり、
それぞれのエッジに対して $ x_1, x_2, ... , x_K $ という選択の基準となる値を持ち、
その集合を$ {\bf X_k} $とする。
$ x_i $が小さい値を持つもののほうが選択されやすいとすると、
選択肢 $ k $ が選択される確率 $ p_k $ は、

\begin{equation}
p_k = \frac{ e^{ -\theta x_k } }{ \displaystyle \sum_{ l \in {\bf X_k } }^{ K } e^{ -\theta x_l }  } 
\end{equation}

{\noindent と}なる。
ここで、$ \theta $ は選択の基準となる値に対する感度パラメータで、
$ \theta $ が大きいほど値の差に対して敏感になり、
結果として $ x_k $ の値が小さいものが選択されやすくなる。
つまり、$ x_k $ の値を目的地までの経路の距離とすると、
$ \theta $ が大きければ大きいほど最短経路が選択される確率が大きくなり、
$ \theta $ が小さければ、最短経路に従わず遠回りして目的地に向かう経路を選択する確率が高くなる。

図\ref{fig:LOGITGRAPH}は経路AとBがあったときに、
そのAとBの経路の距離差と感度パラメータ $ \theta $ によって
経路Aの選択確率がどのように変化するかを表している。
$ \theta = 0.01 $ の場合、
Aのほうが距離が5単位ほど短くても
Aを選択する確率が若干あがる程度で、ほぼ50\%の確率で経路Bも選択される。
$ \theta = 1.0 $ の場合、
同様にAのほうが距離が5単位ほど短いとき、
今度はBを選択する確率はほとんどなくなっている。
$ \theta $ の値が大きくなるほど、距離の差に敏感になっていることがわかる。

本モデルでは、経路選択の基準となる値として、接近率を採用している。
接近率とは、実際歩いた距離に対して、目的地にどれくらい近づいたかを表す値であり、0.0〜1.0の間の値となる。
接近率が負の値の場合、そのエッジは目的地から遠ざかる道であるため、
選択肢から除外している。
目的地 $ p_D $ を目指しているある利用者がノード $ n_i $に到達し、
次の経路として $ m $ 本のエッジから選択しなければならない場合、
まずそれぞれの選択肢毎に接近率を計算する。
経路選択肢のうちエッジ $ e_{i j} $ の接近率 $ c_j $ は以下のように計算される。

\begin{equation}
c_j = \frac{ \hat{ \delta }_{ i } - \hat{ \delta }_{ j } }{ d_{i j} } 
\end{equation}

{\noindent こ}こで、$ \hat{ \delta }_{ i } $ はノード $ n_i $ から $ p_D $ までの最短経路の距離で、
式(\ref{eq:deltahat})から計算される。
上式の分子は
$ e_{i j} $ を選択することによって、
次のノードに到着したとき、どの程度目的地に近づくことが出来るかを表しており、
分母は次のノードまでの距離となっている。
つまり、$ c_j = 1.0 $ のとき、
進んだ距離と目的地に近づいた距離が等しくなるため、
$ e_{ij} $ が最短経路であることがわかり、
$ c_j $ の値が小さいときは
進んだ距離に対してあまり目的地に近づけていないため、
遠回りの経路であることがわかる。

本経路選択モデルによって実際の地図データ上で経路選択を行った結果を図\ref{fig:ROUTING4}に示す。
図\ref{fig:ROUTING4}の経路選択は、調布駅周辺の地図データを用いて行った。
図\ref{fig:ROUTING4}(a)は始点終点間の最短経路を示している。
図\ref{fig:ROUTING4}(b)は始点終点間を感度パラメータ $ \theta = 10.0 $ で1000回選択させた結果である。
個々のエッジ毎に通過した回数をカウントしておき、
通過する回数が多かったエッジほど太く表示されるようになっている。
$ \theta = 10.0 $ の場合は、ほとんどの経路が最短経路に沿った経路となっていることがわかる。
図\ref{fig:ROUTING4}(c)は $ \theta = 0.1 $ で同様の実験を行った結果である。
$ \theta = 10.0 $ の場合と比較すると、 $ \theta = 0.1 $ のときは移動経路が分散されていることがわかる。

上記の結果を見ればわかるように、本経路選択モデルでは、
朝の通勤者のように目的地までなるべく早く移動しようとしている利用者や、
催し物が行われている場所を回遊しているような、目的地へそれほど急いでいない利用者を
感度パラメータ $ \theta $ の大小によって、表現することができる。\\
%
%
\begin{figure}
\begin{center}
 \begin{tabular}{c c}
  \scalebox{0.5}{\includegraphics{ROUTING3a.eps}} &
  \scalebox{0.5}{\includegraphics{ROUTING3b.eps}} \\
  
  (a) 最短経路を選択した場合 &
  (b) 直感的な経路選択の予想 \\
 \end{tabular}
\end{center}
 \caption{経路選択方法による選択経路の分散}
 \label{fig:ROUTING3}
\end{figure}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{270}{\scalebox{0.4}{\includegraphics{LOGITGRAPH.eps}}}
 \caption{ ロジットモデルにおける感度パラメータの効果 }
 \label{fig:LOGITGRAPH}
\end{center}
\end{figure}
\end{center}
%
%
\begin{figure}
\begin{center}
 \begin{tabular}{c c}
  \rotatebox{0}{\scalebox{0.6}{\includegraphics{ROUTING4a.eps}}} \\
  (a) 最短経路 \\
  \\
  
  \rotatebox{0}{\scalebox{0.6}{\includegraphics{ROUTING4b.eps}}} &
  \rotatebox{0}{\scalebox{0.6}{\includegraphics{ROUTING4c.eps}}} \\
  
  \begin{tabular}{c}
  (b) ロジットモデルによる経路選択 \\
  ($ \theta = 10.0 $)
  \end{tabular} &
  \begin{tabular}{c}
  (c) ロジットモデルによる経路選択 \\
  ($ \theta = 0.1 $) 
  \end{tabular}\\
 \end{tabular}
\end{center}
 \caption{感度パラメータによる経路選択行動の変化の様子}
 \label{fig:ROUTING4}
\end{figure}
%
%


\subsection{型の設定}

本モデルでは、
利用者の行動を型の組み合わせによって表現する。
一つの型は、その型に従った行動を行う利用者の発生の空間的・時間的な分布、、
利用者の移動・退去といった空間的な行動、
発呼や、強制切断時の再呼といったトラフィックに関する行動という、
3種類の特徴の記述によって定義される。


\subsubsection*{利用者発生の空間的・時間的な分布}

アンテナと利用者からの発呼に着目した移動体通信の性能評価に関するモデルでは、
呼の到着や移動に単純なポアソン到着や指数分布を仮定しているものが多い。
しかし、現実の都市空間では、
単純な分布を仮定すると大きく誤差が生じる可能性がある。
例えば駅の周辺をカバーするアンテナに到着する利用者の時間的な分布を考えると、
図\ref{fig:APPEARANCE}のように、
定期的な電車の到着とともに集団で発生する利用者と、
駅に向かって移動してくることによって断続的に到着する利用者を
重ね合わせたような分布となり、
結果として単純なポアソン到着とは明らかに異なった分布となる。
本モデルでは、利用者の時間的な発生の分布を型毎に定義することを可能とし、
上記のような異なった特徴の分布の重ね合わせを、
型の重ね合わせによって実現する。

また、発生の空間的な分布も、
利用者の型によって異なる。
つまり、電車から降りてくる利用者の発生は駅構内を指す分布を反映するものになるであろう。
朝に駅に向かう利用者の発生の分布は住宅人口分布を反映すると考えるのが妥当である。

このように、本モデルでは型毎に異なった時間的・空間的な発生分布をもたせることによって、
全体としての分布の特徴を作り出す。
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{0}{\scalebox{0.5}{\includegraphics{APPEARANCE.eps}}}
 \caption{ 駅周辺をカバーするセルの到着分布の予想（断続的な到着と定期的な集団到着） }
 \label{fig:APPEARANCE}
\end{center}
\end{figure}
\end{center}
%
%

\subsubsection*{空間的な行動}

本モデルでは、
利用者の行動パターンを定義し、そのパターン(型)に従った行動を行う利用者を発生させることによって
利用者の空間的な分布や移動を表現する。
一つの型の利用者の移動や退去など、
空間的な行動は以下の行動要素の組み合わせによって定義する。

\begin{itemize}
\item 移動 \\
指定された分布から目的地を決定し、都市構造に従って移動する。
\item 待機（時間） \\
指定された時間の分布によって待ち時間を決定し、その時間の間その場に待機する。
\item 待機（イベント） \\
電車の到着など、指定されたイベントが発生するまでその場に待機する。
\item 退去 \\
電車への乗車や目的地への到達などにより、シミュレーションエリアから退去する。
\end{itemize}

{\noindent 例}として、
朝、駅へ向かう通勤客を想定すると、
次のような組み合わせとなる。

\begin{enumerate}
\item 移動 \\
駅のホーム上の分布から目的地を決定し移動する。
\item 待機（イベント） \\
定期的に発生する電車到着のイベントを待つ。
\item 退去 \\
電車到着のイベントと同時にシミュレーションエリアから退去する。
\end{enumerate}


\subsubsection*{発呼行動}

本モデルにおいて発呼行動とは、
利用者の通話状態と非通話状態の切り替えを行う行動を指す。
切り替え行動は、発生や移動などの空間的な行動とは独立したものと考えた。
さらに、本モデルでは、再呼の影響を考慮した。
移動体通信の性能評価に関する多くの研究では、
呼の到着にはポアソン到着など、単純な到着を仮定している。
しかし、現実の携帯電話の使われ方を考えたとき、
通話を開始しようと思って失敗したときや、
通話途中で切断されてしまった場合、
すぐさま再び発呼を試みる（再呼）と考えるのが自然である。
そして、この再呼という行動は、混雑時に呼の発生率を高める影響があり、
結果として移動体通信の性能に大きな影響を与える可能性がある。
本モデルでは、新規発呼時の呼損や、ハンドオーバー失敗による強制切断などによって
呼が本来の通話時間を全うできなかった場合、
次の発呼までの時間間隔を短く設定することによって再呼の影響を考慮した。
つまり、「通話状態」と「非通話状態」の他に「再呼待ち」という状態が加わり、
図\ref{fig:RECALL}のような状態遷移図で書き表すことができる。

本モデルにおいて発呼に関する行動は、
上記の3状態の平均滞在時間を指数分布に従うものとし、
%
\begin{itemize}
\item 平均通話間隔 $ \lambda_p^{-1} $
\item 平均通話時間 $ \mu_p^{-1} $
\item 平均再呼待ち時間 $ \hat{ \lambda }_p^{-1} $ 
\end{itemize}
%
という3つのパラメータで記述する。
ここで、再呼の影響を考慮したい場合、平均値が
 $ \lambda_p^{-1} \gg \hat{ \lambda }_p^{-1} $ のようになり、
影響を考えない場合は$ \lambda_p = \hat{ \lambda }_p $ となる。
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{0}{\scalebox{0.5}{\includegraphics{RECALL.eps}}}
 \caption{ トラフィックに関する行動の状態遷移図 }
 \label{fig:RECALL}
\end{center}
\end{figure}
\end{center}
%
%

\section{シミュレーションシステム}

\subsection{シミュレーションシステム概要}

本節では前節で説明したモデルに基づいて開発した
シミュレーションシステムについて説明する。
本システムはサンマイクロシステムズ(株)のJava version 1.4.2を用いて開発した。
そのため、本シミュレーターはJavaが動作する環境ならば
どのような環境でも実行することができる。

本システムの概要図を図\ref{fig:SIMSYSTEM_IN_OUT}に示す。
図に示すように、シミュレーションを実行するためのデータとして、
入力データ(人口分布データ、道路網データ、経路探索データ、セルデータ、シミュレーションシナリオデータ)
が必要であり、
シミュレーション実行によって出力データ(セル毎のトラフィック量、呼損率データ)を得る。
また、シミュレーション実行時の利用者の分布や移動を視覚的に評価・確認することができるようにしている。

次に、本システムの構成を示す。
図\ref{fig:SIMSYSTEM_ABST}は本システムを構成する実行ファイルとデータファイルの関係を表している。
本システムでは、シミュレーションを実行する本体の実行ファイルとは別に、
入力ファイルの編集や結果データの視覚的な表示等をGUIで行うことができるシミュレーションエディタや、
膨大なシミュレーション出力ファイルから性能評価データを抽出するツールも用意した。
また、データには、ユーザーが作成する必要があるデータと、システムが自動的に生成するデータに分けられる。
これらの構成ファイルとデータ構造の詳細については付録に譲る。
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.5}{\includegraphics{SIMSYSTEM_IN_OUT.eps}}
 \caption{ シミュレーションシステム概要 }
 \label{fig:SIMSYSTEM_IN_OUT}
\end{center}
\end{figure}
\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.5}{\includegraphics{SIMSYSTEM_ABST.eps}}
 \caption{ シミュレーションシステム構成図 }
 \label{fig:SIMSYSTEM_ABST}
\end{center}
\end{figure}
\end{center}
%
%


\section{シミュレーション結果の評価}

ここでは、駅の乗降客を中心としたシミュレーションを行い、
駅からの到着のような周期的な影響が性能に与える影響について考察する。
シミュレーション対象エリアは調布駅の徒歩圏とし、
利用者の型としては、
徒歩圏から徒歩で調布駅に向かって歩行し、駅で電車の到着とともに退去する利用者と、
電車の到着とともに徒歩圏に存在する各々の目的地に向かって歩行する利用者を想定している。
また、今回評価するシステムではマイクロセルシステムを想定し、
小さいサイズのセルを一様(混雑部のみ密集)に配置したものを用いた。


\subsection{入力データとパラメータ設定}

\subsubsection*{都市構造に関するデータ}

シミュレーションエリアは調布駅を中心とした徒歩圏であり、
図\ref{fig:MAPDATACHOFU}に示すような東西2.5km、南北3.0km のエリアになる。
今回のシミュレーションでは
鉄道を除きこのエリア外からの流入やエリア外への流出は考えない。
地図データは市販の地図ソフトウェアを基に、
京王線調布駅を中心として歩行者の歩行経路となる道路を抽出し、
シミュレーションエディタによって入力した（図\ref{fig:CHOFUMAP}）。
ノード数は2000個、エッジ数は2562個である。
（この場合、ノード間の経路情報テーブル $ {\bf \widehat{ D } } $ の計算時間は
CPUがPentium4 2GHzクラスのPCで30秒程度であった）
国道、県道などの主要道路や交差点にはその道路を横断するための信号があり、
60秒ごとに通行可能な状態と不可能な状態を変化させている。
また、電車の到着は、朝のラッシュ時にあわせて150秒間隔で到着するものとした。
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.75}{\includegraphics{MAPDATACHOFU.eps}}
 \caption{シミュレーションエリア}
 \label{fig:MAPDATACHOFU}
\end{center}
\end{figure}
\end{center}
%
%


\subsubsection*{人口分布等利用者発生に関するデータ}

朝の通勤時間帯において、自宅から駅に向かって電車に乗り込む人と、
電車を降りて駅から目的地に向かって歩いていく人を想定する。
まず、駅に向かう人は、その発生は住宅人口分布(=夜間人口分布)に従って発生し、
目的地の分布は駅のホーム上のみの分布である。
次に、駅から目的地に向かう人は、
駅のホーム上に発生して、
目的地の分布は昼間人口分布とした。
昼間人口分布、夜間人口分布は国勢調査結果から推定し、
メッシュデータを構成した。

また、これらの人の発生数であるが、
国勢調査に記載されている調布市の昼間流入流出人口(流入人口:52,023,流出人口:81,234)と、
調布駅の乗降客人数・電車本数から推定し、
結果として、150秒ごとに到着する電車に、
およそ641人乗り込み、426人降車してくるような発生数とした。

集団到着・退去の原因となる交通手段として、
バスも考えられるが、武蔵野市の交通に関する統計によると、
京王線調布駅の一日の乗降人数が十万人であるのに対して、
調布駅周辺のバスの乗降人数が約6000人であることから影響は少ないと考え、
ここではバスの乗降は考慮していない。


\subsubsection*{発呼行動に関するデータ}

平成11年版 通信白書より、
利用者一人当たりの一回当たりの平均通話時間と、
平均通話間隔を算出し、
平均通話時間の平均を600秒(5分)、
平均通話間隔の平均を21221秒(約6時間)とした。


\subsubsection*{セルに関するデータ}

シミュレーションエリアは
半径100mのセルを図\ref{fig:SIMCELLDATA}のように一様に配置するような
マイクロセル構造によってカバーした。
また、駅中心部だけは非常に混雑するため、
図\ref{fig:SIMCELLDATASTATION}のようにセルを集中配置した。
本シミュレーションでは、
利用者からの呼は最も近いアンテナに接続するようにしているため、
各セルのエリアは図\ref{fig:SIMCELLDATAVORONOI}のように、
アンテナによってボロノイ分割\cite{VORONOI}したような構造になる。
また、各セルは5個ずつチャネルを持つとする。
セルの配置やチャネル数などのパラメータはシミュレーションエディタによって容易に変更することができる。
%
%
%\begin{center}
%\begin{figure}
%\begin{center}
% \rotatebox{0}{\scalebox{0.75}{\includegraphics{SIMCELLDATA.eps}}}
% \caption{シミュレーションで用いたセル構造}
% \label{fig:SIMCELLDATA}
%\end{center}
%\end{figure}
%\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.6}{\includegraphics{ALLCELL.eps}}
 \caption{シミュレーションで用いたセル構造}
 \label{fig:SIMCELLDATA}
\end{center}
\end{figure}
\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{0}{\scalebox{0.4}{\includegraphics{SIMCELLDATASTATION.eps}}}
 \caption{シミュレーションで用いたセル構造（駅周辺）}
 \label{fig:SIMCELLDATASTATION}
\end{center}
\end{figure}
\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{0}{\scalebox{0.4}{\includegraphics{SIMCELLDATAVORONOI.eps}}}
 \caption{シミュレーションで用いたセル構造（ボロノイ分割）}
 \label{fig:SIMCELLDATAVORONOI}
\end{center}
\end{figure}
\end{center}
%


\subsection{シミュレーション結果}

本節では、前節で示したデータを元に
利用者の一人当たりの発呼率 $ \lambda_p $ を1.0倍、1.5倍、2.0倍と変化させた場合、
再呼を考慮した場合としない場合についてシミュレーションを行った結果を示す。
シミュレーションに用いたパラメータを
表\ref{fig:SIMRESULT_PARAM1}、表\ref{fig:SIMRESULT_PARAM2}に示す。
%
%
\begin{table}
\begin{center}
\caption{固定パラメータ}
\begin{tabular}{|l|l|} \hline
シミュレーション時間 & 13時間 \\\hline
集計時間 & 12時間(開始1時間後から集計) \\\hline
\multicolumn{1}{|l}{利用者発生数} & \multicolumn{1}{l|}{} \\\hline
利用者型1(電車乗客型) & 指数分布0.234秒の間隔で1人発生 \\\hline
利用者型2(電車降客型) & 電車到着間隔(150秒毎)で426人発生 \\\hline
\end{tabular}
\end{center}
\label{fig:SIMRESULT_PARAM1}
\end{table}
%
%
\begin{table}
\begin{center}
\caption{シミュレーション毎のパラメータ}
\begin{tabular}{|l|r|r|r|} \hline
& $ \lambda_p $ × 1.0
(再呼なし) & $ \lambda_p $ × 1.5
(再呼なし) & $ \lambda_p $ × 2.0
(再呼なし) \\\hline
平均発呼間隔 & 21221秒 & 14147秒 & 10610秒 \\\hline
平均再呼待ち時間 & − & − & − \\\hline
平均通話時間 & 300 秒 & 300 秒 & 300 秒 \\\hline
& $ \lambda_p $ × 1.0
(再呼あり) & $ \lambda_p $ × 1.5
(再呼あり) & $ \lambda_p $ × 2.0
(再呼あり) \\\hline
平均発呼間隔 & 21221秒 & 14147秒 & 10610秒 \\\hline
平均再呼待ち時間 & 30 秒 & 30 秒 & 30 秒 \\\hline
平均通話時間 & 300 秒 & 300 秒 & 300 秒 \\\hline
\end{tabular}
\end{center}
\label{fig:SIMRESULT_PARAM2}
\end{table}
%
%

\subsubsection*{エリア内人数の推移と利用者の空間的な分布}

図\ref{fig:SIMRESULT_ALLUSER}は系内人数と利用者数の変化を
シミュレーション時間1秒刻みでカウントしたものである。
系内人数0人から開始し、30分程度で、
図に示すほぼ周期的な変動となった。
60分〜120分までの平均系内人数は6152人で、
周期的変動は鉄道による歩行者の到着と退去の影響である。
ここでは午前8時頃の通勤時間帯での道路上を移動する歩行者人数の変動による影響を評価するために、
歩行者は目的地に到着した時点で、システムから退去するものとした。
% 
% 
\begin{center} 
\begin{figure} 
\begin{center} 
 \rotatebox{0}{\scalebox{0.6}{\includegraphics{SIMRESULT_ALLUSER.eps}}} 
 \caption{シミュレーションエリア内の利用者数の推移} 
 \label{fig:SIMRESULT_ALLUSER} 
\end{center} 
\end{figure} 
\end{center} 
% 
% 
\subsubsection*{セル内滞在人数}

図\ref{fig:SIMRESULT_COUNT9_15}は、
駅を中心とした混雑するエリアをカバーしている
セル内に滞在する人数の定常状態時の時間による推移である。
グラフ中のセルの番号は図\ref{fig:SIMCELLDATASTATION}で
セル毎に振られている番号と一致する。
駅周辺では、電車の到着とともに利用者が集団到着するため、
人数の推移に周期性があらわれる。

図\ref{fig:SIMRESULT_COUNT41_165}は、
セル番号41,75,107,137,165のセル内滞在人数の定常状態時の時間による推移である。
セル番号が大きくなるほど駅から南西方向に離れた位置に存在するセルであり、
離れれば離れるほど周期的な影響が減衰しているのがわかる。
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{0}{\scalebox{0.6}{\includegraphics{SIMRESULT_COUNT9_15.eps}}}
 \caption{セル密集エリアのセル毎のセル内滞在人数の推移}
 \label{fig:SIMRESULT_COUNT9_15}
\end{center}
\end{figure}
\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \rotatebox{0}{\scalebox{0.6}{\includegraphics{SIMRESULT_COUNT41_165.eps}}}
 \caption{セル密集エリアのセル毎のセル内滞在人数の推移}
 \label{fig:SIMRESULT_COUNT41_165}
\end{center}
\end{figure}
\end{center}
%
%

\subsubsection*{呼損発生の空間的な分布} 

呼損の発生状況を観察する。
ここであるセル $ i $ の呼損率 $ p_{b_i} $ とは、そのセルへハンドオーバーしてきた時の強制切断も含み、 
以下のように計算している。 

\begin{equation} 
\label{eq:CLP} 
p_{b_i} = \frac{ 新規発呼時の呼損回数 + ハンドオーバー時の強制切断回数 }{ 新規発呼発生回数 + ハンドオーバー呼発生回数  } 
\end{equation} 

図\ref{fig:SIMRESULT_RXX}は利用者一人当たりの発呼率 $ \lambda_p $ を 
変化させたときの駅周辺のセル毎の呼損率を色の濃淡で示したものである。 
(a)(b)(c)は再呼を考慮しない場合、
(d)(e)(f)は再呼を考慮した場合の結果である。
濃淡が濃いセルほど呼損が多く発生している。 
(a)を見ると(T)駅をカバーするセル、(U)駅から西に延びる道路沿いをカバーするセル、
(V)甲州街道を横断し北方向に向かう道路をカバーするセルで多く呼損が発生していることがわかる。
(T)や(U)で呼損が多く発生するのは利用者が多く滞在、通過するためであり、
特に駅をカバーするセル(T)では、
電車の待ち時間があるぶん他のセルよりも利用者一人当たりのセル内滞在時間が多くなるために、
結果としてセル内のトラフィック量が多くなり、呼損率も大きくなっている。
また(V)のセルでは、
交通量の多さに加えて甲州街道をまたぐ信号機があるため、
利用者の滞留が起こり、駅同様にセル内滞在時間が長くなるために、
交通量が同じ程度の道路と比較しても呼損が発生しやすくなっている。
このように、今回扱ったシステムのようにセルのサイズが小さい場合は、
都市構造から受ける影響の度合いが大きくなるため、
これらの要素を考慮した評価が必要であることがわかる。

また再呼の影響であるが、
(a)と(d)、(b)と(e)、(c)と(f)を比較すると、
再呼によるトラフィック量の増加によって再呼考慮時の呼損率は大きくなっていることが分かる。
図\ref{fig:SIMRESULT_RECALLDIST}はセル毎に到着した呼の種類に関して再呼の割合を濃淡で表したものであり、
表\ref{tab:SIMRESULT_RECALL}は利用者一人当たりの発呼率 $ \lambda_p $ を変化させたときに、
駅をカバーするセルに隣接しているセルの呼損率を再呼なしの場合と再呼ありの場合で、
比較したものである。
表を見ると、 $ \lambda_p $ が小さいときは再呼の影響はそれほどないが、
$ \lambda_p $ が大きくなるほど呼損率の差が大きくなっている。
これは$ \lambda_p $ が大きくなれば駅をカバーするようなセルなど、
利用者が集中するセルにおいて呼損が発生する可能性が高くなり、
その結果として再呼待ち状態に陥る利用者が増加する。
そしてそれらの利用者が周囲のセルに移動することによって
周囲のセルにも再呼待ちの利用者が増加し、トラフィック量が大きくなるため、
結果として呼損率が大きくなっていくと考えられる。

つまり呼損率が高いセルが近くにあるセルは
再呼を考慮するかしないかによって、
セル間の相互作用により呼損率評価にずれが生じている。
セルラー方式移動体通信システムの性能評価に関する研究で、
セル毎の呼の到着に独立性を仮定しているものが多いが、
上記の結果はこのような複数セルでのセル間の相互作用を評価の必要性を示唆している。

表\ref{tab:SIMRESULT_CALLTYPE} に、
$ \lambda_p $ が1.0倍、2.0倍の場合に、(T)(U)(V)のセルで発生した呼の構成を示す。
今回扱ったような小さなサイズのセルでは、
歩行者のみを扱った場合でもハンドオーバー呼の割合が全体として大きい。
また(T)のような歩行者の滞留が起こるようなセルでは他と比較してハンドオーバー呼の比率が低く、
呼損が多く発生するセルほど再呼による呼の割合が大きいことが分かる。
%
%
\begin{figure} 
\begin{center} 
 \begin{tabular}{c c c} 
  \rotatebox{0}{\scalebox{0.25}{\includegraphics{SIMRESULT_R10.eps}}} & 
  \rotatebox{0}{\scalebox{0.25}{\includegraphics{SIMRESULT_R15.eps}}} & 
  \rotatebox{0}{\scalebox{0.25}{\includegraphics{SIMRESULT_R20.eps}}} \\ 
  
  (a) $ \lambda_p $ 等倍(再呼なし) & 
  (b) $ \lambda_p $ 1.5倍(再呼なし) & 
  (c) $ \lambda_p $ 2.0倍(再呼なし) \\ 
  
  \\ 
  
  \rotatebox{0}{\scalebox{0.25}{\includegraphics{SIMRESULT_R10_RC30.eps}}} & 
  \rotatebox{0}{\scalebox{0.25}{\includegraphics{SIMRESULT_R15_RC30.eps}}} & 
  \rotatebox{0}{\scalebox{0.25}{\includegraphics{SIMRESULT_R20_RC30.eps}}} \\ 
  
  (d) $ \lambda_p $ 等倍(再呼あり) & 
  (e) $ \lambda_p $ 1.5倍(再呼あり) & 
  (f) $ \lambda_p $ 2.0倍(再呼あり) \\ 
  
 \end{tabular}
\end{center}
 \caption{呼損発生の空間的な分布}
 \label{fig:SIMRESULT_RXX}
\end{figure}
% 
% 
%\begin{center}
%\begin{figure}
%\begin{center}
% \rotatebox{0}{\scalebox{0.6}{\includegraphics{SIMRESULT_RECALL.eps}}} 
% \caption{再呼による影響} 
% \label{fig:SIMRESULT_RECALL} 
%\end{center}
%\end{figure}
%\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.5}{\includegraphics{SIMRESULT_RECALLDIST.eps}} 
 \caption{再呼の割合} 
 \label{fig:SIMRESULT_RECALLDIST}
\end{center}
\end{figure}
\end{center}
%
%
\begin{table}
\begin{center}
\caption{ 再呼考慮による呼損率への影響 }
\label{tab:SIMRESULT_RECALL}
\begin{tabular}{|l|r|r|r|} \hline
 & \multicolumn{3}{c|}{発呼率} \\\cline{2-4}
 & $ \lambda_p \times 1.0 $ & $ \lambda_p \times 1.5 $ & $ \lambda_p \times 2.0 $ \\\hline
Cell 9(再呼なし) & 0.0069 & 0.0253 & 0.0442 \\\hline
Cell 15(再呼なし) & 0.0081 & 0.0170 & 0.0241 \\\hline
Cell 9(再呼あり) & 0.0124 & 0.0576 & 0.0934 \\\hline
Cell 15(再呼あり) & 0.0114 & 0.0590 & 0.1074 \\\hline
\end{tabular}
\end{center}
\end{table}
$
$
\begin{table}
\begin{center}
\caption{セル毎の呼の構成}
\label{tab:SIMRESULT_CALLTYPE}
\begin{tabular}{|l|r|r|r|r|r|r|} \hline
 & \multicolumn{3}{c|}{ $ \lambda_p \times 1.0 $ } & \multicolumn{3}{c|}{ $ \lambda_p \times 2.0 $ } \\\cline{2-7}
 & \multicolumn{1}{c|}{T} & \multicolumn{1}{c|}{U} & \multicolumn{1}{c|}{V} & \multicolumn{1}{c|}{T} & \multicolumn{1}{c|}{U} & \multicolumn{1}{c|}{V} \\\hline
新規発呼の割合 & 0.311 & 0.334 & 0.333 & 0.257 & 0.299 & 0.280 \\\hline
ハンドオーバーの割合 & 0.524 & 0.649 & 0.641 & 0.287 & 0.513 & 0.552 \\\hline
再呼の割合 & 0.166 & 0.017 & 0.026 & 0.456 & 0.188 & 0.168 \\\hline
\end{tabular}
\end{center}
\end{table}
% 
% 


\subsubsection*{移動の影響} 

図\ref{fig:SIMRESULT_WALKEFFE}は利用者の移動によるトラフィック分布への影響を示したものである。
(a)は利用者全員が型に従って移動するようなシミュレーション結果であり、
(b)は半数の利用者が昼間人口分布に従って発生し、
移動せずシミュレーション終了までその場で発呼行動を繰り返した場合の結果であり、
(c)は全員が静止利用者であった場合の呼損率の分布である。
濃淡が濃いセルほど呼損率が高い。
シミュレーションパラメーターは本節の初めに記述したものを用いている。
図\ref{fig:SIMRESULT_WALKEFFE}(a)と(c)を比較すると、
移動を考慮した場合とそうでない場合ではトラフィックの分布に大きな違いがあることがわかる。

これは、たとえ人口分布が低い場所であっても、
通行量が多い場所ではトラフィック量が多くなるため、
それらの考慮による差がこの程度の大きさのセル構造では顕著に表れているためと考えられる。
実データからトラフィックの空間的な分布を予測するモデルには、
移動を考慮せずに人口分布からトラフィック需要の空間的な分布を推定しているものがあるが、
この結果は都市構造に従った移動を考慮することの重要性を示唆している。
%
%
\begin{figure} 
\begin{center} 
 \begin{tabular}{c c c} 
  \scalebox{0.5}{\includegraphics{SIMRESULT_WALKEFFE_10.eps}} & 
  \scalebox{0.5}{\includegraphics{SIMRESULT_WALKEFFE_05.eps}} & 
  \scalebox{0.5}{\includegraphics{SIMRESULT_WALKEFFE_00.eps}} \\ 
  
  (a) 全員移動 & 
  (b) 半数移動・半数静止 & 
  (c) 全員静止 \\ 
  
 \end{tabular} 
\end{center} 
 \caption{移動考慮の影響}
 \label{fig:SIMRESULT_WALKEFFE} 
\end{figure} 
% 
% 


\subsubsection*{M/M/k/k待ち行列モデルとの比較} 

ここでは、シミュレーションによって得られた呼損率と、 
M/M/k/k待ち行列モデルで計算した呼損率を比較する。 
M/M/k/kの評価に用いた $ \lambda $ , $ \mu $ はセル毎にシミュレーションで 
計測された値で計算している。 

シミュレーション結果を見ると、 
セルによって、M/M/k/kでの評価とほぼ一致しているものもあれば、 
シミュレーション結果から得られる呼損率が著しく高いものもある。 
ここで、呼損率がシミュレーション結果とM/M/k/kで異なるものについて、 
両者の結果がほぼ一致しているCell 40と、 
ずれが生じているCell 11を比較することによってその原因を考える。

図\ref{fig:SIMRESULT_MMKKCELL11_40}(c)はCell 11とCell 40の 
シミュレーションで計測された呼損率とM/M/k/kによる呼損率を 
$ \lambda_p $ を変化させつつ比較したものである。 
これをみると、$ \lambda_p $ の値によらず、 
Cell 11の呼損率がM/M/k/kによる評価とずれていて、 
Cell 40の呼損率のほうはほぼ一致していることがわかる。 

図\ref{fig:SIMRESULT_MMKKCELL11_40}(a)に示すように、
Cell 11は主に駅のホーム上をカバーしているセルであり、 
Cell 40は駅から北西方面に300mほど離れた位置をカバーしているセルである。 
図\ref{fig:SIMRESULT_MMKKCELL11_40}(b) は2つのセルのセル内滞在人数の時間推移を比較したものである。 
この図をみると、電車から降りてくる利用者から受ける影響の差が顕著に表れていることがわかる。 
この結果から、利用者の到着にポアソン到着を仮定しても問題ないセルもある一方で、
集団で利用者が発生するようなCell 11のように、
都市構造や利用者行動を考慮すべきセルも存在することがわかる。
%
%
\begin{figure}
\begin{center}
 \begin{tabular}{c}
 
  \scalebox{0.6}{\includegraphics{SIMRESULT_MAP11_40.eps}} 　　
  \scalebox{0.6}{\includegraphics{SIMRESULT_COUNT11_40.eps}} \\
 
  (a) Cell 11,40 の位置 　　　　　　　　　　　　　
  (b) セル内滞在人数の推移 \\
  \\
 
  \scalebox{0.7}{\includegraphics{SIMRESULT_MMKKCELL11_40.eps}}\\
  
  (c) 呼損率 \\

 \end{tabular}
\end{center}
 \caption{Cell 11 と Cell 40 の比較}
 \label{fig:SIMRESULT_MMKKCELL11_40}
\end{figure}
%
%


\subsubsection*{セル配置の差による性能への影響}

混雑部にセルを集中配置した場合と、
混雑部にも一様配置を行った場合での比較を行う。
図\ref{fig:SIMRESULT_R10_CELL}(a) は駅周辺の混雑部にセルを集中配置した場合、
図\ref{fig:SIMRESULT_R10_CELL}(b) は混雑部にも一様配置を行った場合の呼損の分布である。
このシミュレーションでは再呼は考慮していない。
混雑部にセルを集中配置することによって領域の呼損率が約半分程度に緩和されていることがわかる。

また、表\ref{fig:SIMRESULT_R10_CELL100_T} は一様配置のみの場合、
表\ref{fig:SIMRESULT_R10_CELL100+50_T} は一部集中配置の場合の
駅周辺に配置したセル(一様配置の場合は7セル、集中配置の場合は13セル)について、
1シミュレーションでのトラフィック量(新規発呼・ハンドオーバー呼の回数)、
呼損の回数(新規発呼・ハンドオーバー時の強制切断)、呼損率を集計した表である。
一様配置の場合の混雑部での呼損率が0.344であるのに対して、
集中配置の場合は0.147となっている。
集中配置時を行った場合に混雑部で大きく性能が向上していることがわかる。
また、集中配置を行ったほうがセルの境界が増えるためにハンドオーバー呼は増加しており、
混雑部のトータルでのトラフィック量は増加しているが、
それが性能に与える影響はみられない。

図\ref{fig:SIMRESULT_R10_CELL100shift50}はセルの配置を
全体的にずらした場合の呼損発生分布の変化の様子を表している。
図\ref{fig:SIMRESULT_R10_CELL100shift50}(a)に対して、
図\ref{fig:SIMRESULT_R10_CELL100shift50}(b)は全体的に東方向に50mずらしている。
各セルに含まれるトラフィックの発生要素(道路、信号等)が変化するため、
セル毎の呼損率が変化している。
セル配置の違いによる呼損の発生はかなり配置に依存するため、
今回評価を行ったような細かいセル構造では
それらの要素をきめ細かく把握、考慮する必要があることがわかる。
%
%
\begin{figure} 
\begin{center} 
 \begin{tabular}{c c c} 
  \scalebox{0.4}{\includegraphics{SIMRESULT_R10_CELL100.eps}} & 
  \scalebox{0.4}{\includegraphics{SIMRESULT_R10_CELL100+50.eps}} \\ 
  
  (a) 一様配置時の呼損率の分布 & 
  (b) 混雑部集中配置時の呼損率の分布 \\ 
  
 \end{tabular} 
\end{center} 
 \caption{セル配置の差による性能への影響}
 \label{fig:SIMRESULT_R10_CELL} 
\end{figure} 
% 
% 
\begin{table}[htbp]
\begin{center}
\caption{一様配置のみの場合の性能評価データ}
\begin{tabular}{|l|r|r|r|r|r|r|r|r|} \hline
 & \multicolumn{1}{l|}{Cell 9} & \multicolumn{1}{l|}{Cell 10} & \multicolumn{1}{l|}{Cell 8} & \multicolumn{1}{l|}{Cell 38} & \multicolumn{1}{l|}{Cell 37} & \multicolumn{1}{l|}{Cell 35} & \multicolumn{1}{l|}{Cell 36} & \multicolumn{1}{l|}{合計} \\\hline
新規発呼回数 & 3010 & 888 & 569 & 539 & 301 & 207 & 136 & 5650 \\\hline
HandOver呼回数 & 1860 & 947 & 905 & 595 & 376 & 302 & 157 & 5142 \\\hline
新規発呼失敗回数 & 2059 & 114 & 49 & 15 & 2 & 0 & 0 & 2239 \\\hline
HandOver呼失敗回数 & 1238 & 133 & 73 & 24 & 3 & 0 & 0 & 1471 \\\hline
呼損率 & 0.677 & 0.135 & 0.083 & 0.034 & 0.007 & 0.000 & 0.000 &  \\\hline
領域呼損率 & \multicolumn{1}{r}{} & \multicolumn{1}{r}{} & \multicolumn{1}{r}{} & \multicolumn{1}{r}{} & \multicolumn{1}{r}{} & \multicolumn{1}{r}{} & \multicolumn{1}{r|}{} & 0.344 \\\hline
\end{tabular}
\end{center}
\label{fig:SIMRESULT_R10_CELL100_T}
\end{table}
%
%
\begin{table}[htbp]
\begin{center}
\caption{セルを混雑部に集中配置した場合の性能評価データ}
\begin{tabular}{|l|r|r|r|r|r|r|r|} \hline
 & \multicolumn{1}{l|}{Cell 10} & \multicolumn{1}{l|}{Cell 11} & \multicolumn{1}{l|}{Cell 16} & \multicolumn{1}{l|}{Cell 8} & \multicolumn{1}{l|}{Cell 44} & \multicolumn{1}{l|}{Cell 9} & \multicolumn{1}{l|}{Cell 15} \\\hline
新規発呼回数 & 1869 & 799 & 672 & 398 & 391 & 284 & 357 \\\hline
HandOver呼回数 & 1761 & 1068 & 1012 & 1022 & 1003 & 1018 & 752 \\\hline
新規発呼失敗回数 & 956 & 89 & 59 & 13 & 17 & 2 & 3 \\\hline
HandOver呼失敗回数 & 881 & 119 & 61 & 34 & 21 & 3 & 3 \\\hline
呼損率 & 0.593 & 0.188 & 0.074 & 0.043 & 0.025 & 0.011 & 0.011 \\\hline
 & \multicolumn{1}{l|}{Cell 43} & \multicolumn{1}{l|}{Cell 42} & \multicolumn{1}{l|}{Cell 41} & \multicolumn{1}{l|}{Cell 12} & \multicolumn{1}{l|}{Cell 13} & \multicolumn{1}{l|}{Cell 14} & \multicolumn{1}{l|}{合計} \\\hline
新規発呼回数 & 322 & 170 & 149 & 92 & 84 & 24 & 5611 \\\hline
HandOver呼回数 & 429 & 172 & 355 & 226 & 906 & 101 & 9825 \\\hline
新規発呼失敗回数 & 4 & 0 & 0 & 0 & 0 & 0 & 1143 \\\hline
HandOver呼失敗回数 & 2 & 0 & 0 & 0 & 1 & 0 & 1125 \\\hline
呼損率 & 0.020 & 0.000 & 0.002 & 0.000 & 0.000 & 0.000 &  \\\hline
領域呼損率 & \multicolumn{1}{r}{} & \multicolumn{1}{r}{} & \multicolumn{1}{r}{} & \multicolumn{1}{r}{} & \multicolumn{1}{r}{} & \multicolumn{1}{r|}{} & 0.147 \\\hline
\end{tabular}
\end{center}
\label{fig:SIMRESULT_R10_CELL100+50_T}
\end{table}
%
%
\begin{figure} 
\begin{center} 
 \begin{tabular}{c c c} 
  \scalebox{0.6}{\includegraphics{SIMRESULT_WALKEFFE_10.eps}} & 
  \scalebox{0.36}{\includegraphics{SIMRESULT_R10_CELL100shift50.eps}} \\
  
  (a) 前節での結果 & 
  (b) セル配置の中心部を東方向に50mずらした結果 \\ 
  
 \end{tabular} 
\end{center} 
 \caption{セル配置の差による性能への影響}
 \label{fig:SIMRESULT_R10_CELL100shift50} 
\end{figure} 
% 
% 


\section{まとめと今後の課題} 

本論文では、数q四方の比較的コンパクトな領域を対象に、
都市構造と、それに依存して行動する移動体通信利用者のモデルを提案した。
そしてそのモデルに基づき、実際の地図データや発呼行動に関するデータ等、
比較的容易に入手することができるデータを用いて
性能評価を行うことができるシミュレーターを開発した。
シミュレーション実験を通して、
都市構造に従った移動や再呼などの利用者行動の考慮や、
都市構造による利用者の集団到着・退去を表現することができた。
そして、これらの特徴などの要素の組み合わせによっては
性能評価に差が生じることが分かった。
AppendixB に示したトラフィック量・呼損率データをみてもわかるように、
調布を中心とした数q四方の領域でもセル間でのバラツキは大変大きい。
呼損率、人口の分布、移動している人の数など、
セルが含む都市構造の要素によってかなり激しくばらつくため、
各セルの状態を把握するためには都市構造の考慮が必要であることが確認された。

シミュレーターでは都市構造、セル配置、人口分布などの
データを容易に編集することができるGUIによる編集システムも含まれ、
直感的に操作できるインターフェースによって移動体通信システムの性能評価における
様々な検証を容易に行える環境も整備している。
これにより、
新規にサービスエリアを展開する場合などに様々なセルの配置を試験したり、
利用者人口の急激に変化が起こった場合の性能検証なども行うことができる。
ただし、JR山手線の内側のような高い人口密度の領域が周辺部まで連続する
地域では領域外の処理を検討する必要がある。
また、本システムは全てJavaで開発したため、安価なPCでも実用的な時間で動作する。

今後の課題として、
%
\begin{itemize}
\item ソフトハンドオフなどの制御方式の考慮
\item 通話だけでなくCDMA方式によるデータ通信品質に関する性能評価
\item 制御信号の輻輳に関する評価、
\item 様々な地域での検証、汎用性の確認
\item セルサイズの実用的範囲の確認
\item 場所に依存した発呼率の変動
\end{itemize}
%
など、シミュレーションならではの評価を行うことが挙げられる。
また、データの入手が困難であったため、
現実の調布駅周辺の歩行者通行量などとの比較、
検証ができていない点も課題である。
\\

\section*{謝辞}

本論文を作成するにあたって熱心にご指導頂きました山田孝子先生、
加藤憲一先生に感謝致します。
また、東京工業大学の高橋幸雄先生、法政大学の宇野斉先生、
高崎経済大学の高橋美佐先生にはそれぞれのご専門のお立場から
大変貴重なご意見・ご指導を頂きました。
最後に山田研、東京工業大学の高橋幸雄研の皆様には
研究やその他の面で大変お世話になりました。
この場をお借りしまして、御礼を申し上げます。

\begin{thebibliography}{9}

\bibitem{QSYMP}
金子 雅志, 山田 孝子, 加藤 憲一, "移動体通信における性能評価のための都市空間を考慮した歩行モデルの構築", 待ち行列シンポジウム報文集, pp.218-227, Jan 2004.

\bibitem{SOFTHANDOFF}
菅野 正嗣, 村田 正幸, 宮原 秀夫, "ソフトハンドオフの影響を考慮したCDMA移動セルラー網の評価", 電子情報通信学会 技術研究報告(SSE99-37), RCS99-61, pp.43-48, July 1999.

\bibitem{DOVE}
Takashi Okuda, Yohei Ando, Tetsuo Ideguchi, Xejun Tian，"A Simplified Performance Evaluation for Delay of Voice End-User in TDMA Integrated Voice/Data Cellular Mobile Communications Systems"，{\it IEEE Globecom2002}, Taipei, 2002.

\bibitem{FPA}
Kenneth Mitchell, Khosrow Sohraby , "An Analysis of the Effects of Mobility on Bandwidth Allocation Strategies in Multi-Class Cellular Wireless Networks", {\it IEEE Infocom 2001 Technical Program.}, pp.1005-1011, 2001.

\bibitem{KURT}
Kurt Tutschku, "Models and Algorithms for Demand-oriented Planning of Telecommunication Systems", Thesis, Wurzburg University, pp.37-47, 1999.

\bibitem{VTT}
VTT Information Technology(Finland), Sami Nousiainen, Krzysztof Kordybach, Paul Kemppi, "User Distribution and Mobility Model Framework for Cellular Network Simulations" , {\it IST Mobile \& Wireless Telecommunications Summit 2002}, 2002.

\bibitem{MAGNET}
Satoshi Matsushita, Shigeyuki Okazaki, "A study of simulation model for pedestrian movement with evacuation and queuing", {\it Proceedings of the International Conference on Engineering for crowd safety}, pp.17-18 march, 1993.

\bibitem{OKADA}
岡田 公孝, 高橋 幸雄, "歩行速度・密度・交通流量間関係式の評価 ―シミュレーションによる検討―", 卒業論文, 東京工業大学, 2001.

\bibitem{ROGIT}
寺本英二，北岡広宣，馬場美也子，棚橋巌, "広域交通流シミュレータNETSTREAMU”，第22 回交通工学研究発表会論文報告集，pp.133-136，2002.

\bibitem{VORONOI}
岡部篤行, 鈴木敦夫, "最適配置の数理", 朝倉書店, 1992.

\bibitem{MAKIMOTO}
牧本直樹, "待ち行列アルゴリズム−行列解析アプローチ", 朝倉書店, 2001.
 
\end{thebibliography}


\newpage
\section*{AppendixA シミュレーションシステムについて}

\section*{シミュレーションシステム構成ファイル}

\subsection*{データファイル群}

\subsubsection*{地図画像データファイル}

道路のグラフ構造を抽出する元データとなるJPEG画像形式の地図画像ファイルである。
この地図画像を元に、\ref{fig:MAPGRAPHEXP} のようにシミュレーションエディタを用いてノードとエッジを入力し、
グラフ構造を構成する。
よって、この地図画像のスケールは1ピクセルが1m×1mである必要がある。
また、この画像データはシミュレーションを視覚的に実行した時に背景として表示することができる。


\subsubsection*{領域データファイル}

図\ref{fig:SIMSYSTEM_POLY}のような町丁目行政界や、
各セルのエリア等を扱うための多角形の集合が記録されているファイルである。
拡張子は「.poly」とする。
個々の多角形にはデータを入力することができ、
人口データを入力することよって多角形データから人口分布メッシュを生成したり、
呼損率データ等のセル毎の性能評価データを入力することによって、
各セルをグラデーションによって表示することによって、
データを視覚的に表示することができる。
領域データはテキストファイルであり、以下のようなのフォーマットでファイルに記録されている。
%
%
\begin{center}
 \begin{tabular}{|l|}
 \hline
  node: \\
  ［頂点ノードID］,［頂点ノードx座標］,［頂点ノードy座標］ \\
  　\vdots \\
  poly: \\
  ［多角形ID］,［頂点ノード数=n］,［頂点ノードID 0］, ... ,［頂点ノードID n-1］,［データ］ \\
  　\vdots \\
 \hline
 \end{tabular}
 \\
 領域データファイルフォーマット
\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.75}{\includegraphics{SIMSYSTEM_POLY.eps}}
 \caption{ 領域データの例(調布駅徒歩圏町丁目行政界) }
 \label{fig:SIMSYSTEM_POLY}
\end{center}
\end{figure}
\end{center}
%
%


\subsubsection*{分布データ}

シミュレーション実行時に歩行のODペアの選択や利用者発生のためのデータ
として図\ref{fig:CHOFUMESH} のような
分布データが必要になる。
分布データはメッシュ構造で表され、そのファイルの拡張子は「.poly」としている。
前節の分布データに関する記載で説明したように粒度の異なるメッシュデータを扱う必要があるために、
メッシュのグリッドサイズやグリッド数を指定できるようになっている。
分布データはテキストファイルであり、以下のようなのフォーマットでファイルに記録されている。
%
%
\begin{center}
 \begin{tabular}{|l|}
 \hline
  node: \\
  ［横グリッド数=X］,［縦グリッド数=Y］,［グリッドサイズ］,［メッシュ始点x］,［メッシュ始点y］ \\
  ［メッシュ(0,0)の値］,［メッシュ(1,0)の値］, ... , ［メッシュ(X-1,0)の値］\\
  ［メッシュ(0,1)の値］,［メッシュ(1,1)の値］, ... , ［メッシュ(X-1,1)の値］\\
  　\vdots \\
  ［メッシュ(0,Y-1)の値］,［メッシュ(1,Y-1)の値］, ... , ［メッシュ(X-1,Y-1)の値］\\
 \hline
 \end{tabular}
 \\
 分布データファイルフォーマット
\end{center}
%
%


\subsubsection*{地図データファイル}

グラフ構造で表した地図データを記録したファイルであり、
そのファイルの拡張子は「.map」としている。
本グラフデータは任意の2ノード間に必ず経路が存在するような連結グラフでなければならない。
シミュレーションエディタによって
1ピクセルが1m×1mにスケーリングされた地図画像データから作成する。
また、地図のエッジには一般の道路の他に信号や踏切などが存在するため、
それらの種別を表す番号を保持している。
%
%
\begin{center}
 \begin{tabular}{|l|}
 \hline
  node: \\
  ［ノードID］,［ノードx座標］,［ノードy座標］ \\
  　\vdots \\
  edge: \\
  ［エッジに接続しているノード0のID］,［エッジに接続しているノード1のID］,［エッジの種別番号］\\
  　\vdots \\
 \hline
 \end{tabular}
 \\
 地図データファイルフォーマット
\end{center}
%
%

\subsubsection*{経路情報データ}

経路情報データが格納されているファイルであり、
そのファイルの拡張子は「.rtbl」としている。
本シミュレーションシステムではシミュレーション実行時の
経路選択に関する計算時間を短縮するために、
あらかじめノード間の最短距離データを記憶しておき、
実行時に読み込んで利用している。
経路情報データはシミュレーションエディタ上で自動的に作成することができる。


\subsubsection*{セルデータ}

評価したいセル構造を記述するファイルであり、
そのファイルの拡張子は「.cell」としている。
データにはセルの座標、半径、チャネル数が記述されていおり、
シミュレーションエディタ上で作成、編集することができる。
セルデータはテキストファイルであり、
以下のようなのフォーマットでファイルに記録されている。
%
%
\begin{center}
 \begin{tabular}{|l|}
 \hline
  ［セル番号］,［セルx座標］,［セルy座標］,［半径］,［チャネル数］ \\
  　\vdots \\
 \hline
 \end{tabular}
 \\
 セルデータファイルフォーマット
\end{center}
%
%


\subsubsection*{シミュレーションシナリオデータファイル}

シミュレーション時間や、シミュレーションクロック等の設定や、
各種データファイルのパス、
シミュレーション制御シグナルの設定や
それらのデータやシグナルを用いた利用者行動パターンの記述、
シミュレーションエリア内に存在する信号機の制御等、
シミュレーション実行のための設定全般が記述されているファイルである。
設定すべき項目を以下に示す。

\begin{table}
\begin{center}
\caption{シミュレーションシナリオデータファイルで設定される項目}
\begin{tabular}{|l|l|l|} 
\hline
項目名 & 項目設定名称 & 説明 \\\hline
シミュレーション時間 & @SIMTIME &
	\begin{tabular}{l} 
	シミュレーションを行う時間を\\秒の単位で設定。 \\
	\end{tabular} \\\hline
シミュレーションクロック & @DT &
	\begin{tabular}{l} 
	シミュレーションクロックを\\秒の単位で設定。 \\
	\end{tabular} \\\hline
視覚的表現時の時間縮尺 & @TIMESCALE &
	\begin{tabular}{l} 
	視覚的表現時のシミュレーション\\実行時間倍率を設定。\\
	\end{tabular} \\\hline
記録ファイル名 & @RECORDFILE &
	\begin{tabular}{l} 
	出力データを記録する\\ファイル名を設定。 \\
	\end{tabular} \\\hline
地図データファイル名 & @MAPDATA &
	\begin{tabular}{l} 
	本シナリオで用いる\\地図データファイル名を設定。 \\
	\end{tabular} \\\hline
経路情報データファイル名 & @ROUTINGDATA &
	\begin{tabular}{l} 
	本シナリオで用いる\\経路情報データファイル名を設定。 \\
	\end{tabular} \\\hline
セルデータファイル名 & @CELLDATA &
	\begin{tabular}{l} 
	本シナリオで用いる\\セルデータファイル名を設定。 \\
	\end{tabular} \\\hline
メッシュデータファイル名 & @MESHDATA &
	\begin{tabular}{l} 
	本シナリオで用いる\\メッシュデータファイル名を\\
	名前付きで設定。 \\
	\end{tabular} \\\hline
シミュレーション制御シグナル定義 & @SIGNAL &
	\begin{tabular}{l} 
	シミュレーション制御信号を定義。 \\
	\end{tabular} \\\hline
利用者行動定義 & @USER &
	\begin{tabular}{l} 
	利用者行動を定義。 \\\hline
	\end{tabular} \\\hline
エッジ動作定義(信号) & @EDGESTATE &
	\begin{tabular}{l} 
	信号等、エッジの動作を定義。 \\\hline
	\end{tabular} \\\hline
\end{tabular}
\end{center}
\label{fig:SIMSYSTEM_SCRIPT}
\end{table}

シミュレーション制御シグナルとは、
ランダムな利用者の発生や、
定期的な電車の到着などのシミュレーション実行に関するものから、
定期的な出力ファイルの書き込みなど、
シミュレーションのシステムに関するものまで、
様々な時間間隔でおこるイベントを抽象化した仕組みである。
シナリオファイル中でそれらの発生間隔を細かく指定することで様々な
イベント発生の時間的な分布を扱うことができる。
発生間隔には指数分布で決まる時間や固定時間などを設定することができる。
シミュレーション制御シグナルを定義するコマンドの一覧を表\ref{fig:SIMSYSTEM_SIGNALSCRIPT}に定義する。
シグナル定義の終端はENDかGOTOである必要がある。
%
%
\begin{center}
 \begin{tabular}{|l|}
 \hline
 @SIGNAL ［シグナル名称］\\
 \hline
 \end{tabular}
 \\
 シグナル定義文
\end{center}
%
%
例として、シミュレーション開始後1分後に一回だけ発生するシグナル「TESTSIGNALA」と、
平均1.5秒の指数分布間隔で発生するシグナル「TESTSIGNALB」と、
電車の到着を表す150秒ごとに定期的に発生するシグナル「TRAIN」を定義すると以下のようになる。
%
%
\begin{center}
 \begin{tabular}{|l|}
 \hline
 @SIGNAL TESTSIGNALA\\
 　　WAITD　60\\
 　　ACTIVE\\
 　　END\\
 \\
 @SIGNAL TESTSIGNALB\\
 　　LABEL\\
 　　WAITE　1.5\\
 　　ACTIVE\\
 　　GOTO\\
 \\
 @SIGNAL TRAIN\\
 　　LABEL\\
 　　WAITD　150\\
 　　ACTIVE\\
 　　GOTO\\
 
 \hline
 \end{tabular}
 \\
 シグナル定義の例
\end{center}
%
%
\begin{table}
\begin{center}
\caption{シミュレーション制御シグナル定義コマンド群}
\begin{tabular}{|l|l|l|} \hline
	コマンド名称 & 形式 & 動作 \\\hline
	ACTIVE & ACTIVE &
	\begin{tabular}{l}
		シグナルを発生させる。 
	\end{tabular} \\\hline
	WAITD & WAITD [待ち時間] &
	\begin{tabular}{l}
		指定した時間待つ。 
	\end{tabular} \\\hline
	WAITE & WAITE [平均待ち時間] &
	\begin{tabular}{l}
		指定した平均時間に従った指数分布の時間待つ。 
	\end{tabular} \\\hline
	LABEL & LABEL &
	\begin{tabular}{l}
		GOTOのジャンプ先を指定する。 
	\end{tabular} \\\hline
	GOTO & GOTO & 
	\begin{tabular}{l}
		LABELで指定した行までジャンプすることによって\\
	ループ処理を実現する。
	\end{tabular} \\\hline
	END & END &
	\begin{tabular}{l}
		シグナル制御シグナルシーケンスを終了する。 
	\end{tabular} \\\hline
\end{tabular}
\end{center}
\label{fig:SIMSYSTEM_SIGNALSCRIPT}
\end{table}
%
%
特殊なシグナルとして、「RECORD」がある。
これは、シミュレーション結果を記録するタイミングを表すシグナルで、
このシグナルを定義しなければ出力ファイルは生成されない。

@USERで定義される型の利用者行動のパターンはシミュレーション制御シグナル定義と同様に、
表\ref{fig:SIMSYSTEM_SIGNALSCRIPT}に示すようなコマンド群によって定義する。
型定義の終端はENDかGOTOである必要がある。
%
%
\begin{center}
 \begin{tabular}{|l|}
 \hline
 @USER ［利用者型名称］ ［発生シグナル名称］ ［1シグナルあたりの発生数］ ［発生分布メッシュ名称］\_\\
 　　　 ［平均通話間隔/平均再呼待ち時間］ ［平均通話時間］ ［行動タイプ］\\
 \hline
 \end{tabular}
 \\
 利用者型定義文
\end{center}
%
%

例として、シグナル「TESTSIGNALB」のタイミングで人口分布「PDMESH」で発生して、
駅を表す分布「STATIONMESH」で目的地を設定して歩行し、
電車到着のシグナル「TRAIN」の発生と同時に退去する利用者「USERA」、
シグナル「TRAIN」とともに100人が集団で到着し、
分布「PDMESH」から目的地を設定して歩行し、
到着と同時に退去する利用者「USERB」、
シミュレーション開始時に一回だけ発生するシグナル「INITSIGNAL」と同時に
グラフ構造に従わずに1000人が分布「PDMESH」に従って発生し、
移動はせずにシミュレーション終了までその場で発呼を繰り返す利用者「USERC」を定義すると以下のようになる。
平均通話間隔は20000秒、平均再呼待ち時間は30秒、平均通話間隔は300秒とした。
また、シグナル「DUMMYSIGNAL」は発生しないシグナルとする。
%
%
\begin{center}
 \begin{tabular}{|l|}
 \hline
 @USER USERA STESTSIGNALB 1 PDMESH 200000/30.0  300.0 GM\\
 　　MOVE STATIONMESH \\
 　　WAITSIGNAL TRAIN \\
 　　END \\
 \\
 @USER USERB TRAIN 100 STATIONMESH 20000.0/30.0 300.0 GM \\
 　　MOVE PDMESH \\
 　　END \\
 \\
 @USER USERC INITSIGNAL 1000 PEDMESH 20000.0/30.0 300.0 M \\
 　　WAITSIGNAL DUMMYSIGNAL \\
 　　END \\
 
 \hline
 \end{tabular}
 \\
 利用者型定義の例
\end{center}
%
%
\begin{table}
\begin{center}
\caption{利用者型行動定義コマンド群}
\begin{tabular}{|l|l|l|} \hline
	コマンド名称 & 形式 & 動作 \\\hline
	
	MOVE & MOVE [目的地分布メッシュ名称] &
	\begin{tabular}{l}
		指定された分布で目的地を設定し、移動する。\\
		移動終了後、次の処理に移行する。
	\end{tabular} \\\hline
	
	WAITD & WAITD [待ち時間] &
	\begin{tabular}{l}
		指定した時間待機する。 
	\end{tabular} \\\hline
	
	WAITE & WAITE [平均待ち時間] &
	\begin{tabular}{l}
		指定した平均時間に従った指数分布の時間\\
		待機する。 
	\end{tabular} \\\hline
	
	WAITSIGNAL & WAITSIGNAL [シグナル名称] &
	\begin{tabular}{l}
		指定したシグナルが発生するまで待機する。 
	\end{tabular} \\\hline
	
	LABEL & LABEL &
	\begin{tabular}{l}
		GOTOのジャンプ先を指定する。 
	\end{tabular} \\\hline
	
	GOTO & GOTO & 
	\begin{tabular}{l}
		LABELで指定した行までジャンプする\\
		ことによってループ処理を実現する。
	\end{tabular} \\\hline
	
	END & END &
	\begin{tabular}{l}
		シグナル制御シグナルシーケンスを終了する。 
	\end{tabular} \\\hline
\end{tabular}
\end{center}
\label{fig:SIMSYSTEM_USERSCRIPT}
\end{table}
%
%

シナリオファイル中の時間の値は全て秒単位で指定し、
行頭に\#が着いている行はコメント行と認識される。
また、シナリオファイル中でファイルパスを指定する場合、
パスの中にスペースを含んではならない。


\subsubsection*{出力データ}

シミュレーション実行後に出力されるファイルには以下の情報が含まれる。
%
\begin{itemize}
\item セル毎の時系列滞在人数
\item セル毎の時系列新規発呼回数
\item セル毎の時系列ハンドオーバー呼回数
\item セル毎の時系列再呼回数
\item セル毎の時系列新規発呼失敗回数
\item セル毎の時系列ハンドオーバー呼失敗回数
\item セル毎の時系列再呼失敗回数
\item シミュレーション時間
\item セル毎のチャネル数
\item セル毎の平均滞在時間
\item セル毎の平均サービス時間
\end{itemize}
%
出力ファイルはカンマ区切りCSV形式ファイルであり、以下のようなフォーマットになっている。
%
%
\begin{center}
 \begin{tabular}{|l|}
 \hline
 ［シミュレーション時刻］,［セル内滞在人数］, ... ,［新規発呼回数］, ... ,［チャネル使用率］, ... , \_\\
 　　　［新規発呼回数］ , ... , ［ハンドオーバー呼回数］ ［再呼回数］\_\\
 　　　［新規発呼失敗回数］ , ... , ［ハンドオーバー呼失敗回数］ ［再呼失敗回数］\\
 　　　 \vdots \\
 End,［シミュレーション時間］ , ... \\
 StayTimeAve,［平均滞在時間］ , ... \\
 MuAve,［平均サービス時間］ , ... \\
 Channel,［チャネル数］ , ... \\
 
 \hline
 \end{tabular}
 \\
 利用者型定義文
\end{center}
%
%

\subsubsection*{性能評価データファイル}

シミュレーション結果のデータから
後述する抽出ツールによって
%
\begin{itemize}
\item 発呼回数(新規、ハンドオーバー、再呼)
\item 呼損回数(新規、ハンドオーバー、再呼)
\item シミュレーションによって計測された呼損率
\item シミュレーションでの発呼量と平均サービス時間からM/M/k/kモデルによって計算された呼損率
\item 平均滞在時間
\item 平均サービス時間
\end{itemize}
%
をセル毎にまとめたCSVファイルである。


\subsection*{実行ファイル群}

本システムに含まれる実行ファイルについて説明する。
実行ファイルは全てJavaで開発されており、
実行にはバージョン1.4以降のJavaの実行環境が必要であり、
mobsim以下の実行ファイルに環境変数のクラスパス(CLASSPATH)が通っている必要がある。

\subsubsection*{シミュレーター本体「SimMain」}

与えられたデータを元に実際にシミュレーションを行う実行ファイルであり、
mobsim.simパッケージに含まれている実行可能Javaクラスである。
実行時にシミュレーションシナリオファイルを指定すると、
そのファイルに記述された設定でシミュレーターを初期化し、
入力データを読み込むことによってシナリオにそったシミュレーションが開始される。
CUIベースで起動する場合、Windowsのコマンドラインでは以下のように実行する。

\begin{center}
 \begin{tabular}{|l|}
 \hline
 ＞java\textvisiblespace mobsim.sim.SimMain\textvisiblespace [シナリオファイルパス] \\
 \hline
 \end{tabular}
\end{center}

\noindent{こ}
のとき、場合によってはメモリ使用量を増やしたい場合のJavaVMへのメモリ割り当てオプション(-Xms,-Xmx)や、
高速化のためにJavaServerVMを起動するオプション(-server)等を指定する必要がある。
図\ref{fig:SIMSYSTEM_SIMMAINEXE}にメモリ・サーバーオプションを付けてシミュレーターを実行した時の様子を示す。

シミュレーション本体が起動されるとシナリオファイルに従って入力ファイルが読み込まれ、実行される。
入力ファイルにエラーがある場合はエラーの内容を出力してシミュレーションは中断される。
シミュレーションの進捗率は標準エラー出力に出力される。
シナリオファイルに出力ファイル名が指定されていない場合は、
シナリオファイル名に通し番号を付加したCSVファイル名で出力ファイルが生成される。
シミュレーションが終了すると計算に要した時間が秒単位で表示される。
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.5}{\includegraphics{SIMSYSTEM_SIMMAINEXE.eps}}
 \caption{ SimMain実行イメージ }
 \label{fig:SIMSYSTEM_SIMMAINEXE}
\end{center}
\end{figure}
\end{center}
%
%

\subsubsection*{シミュレーションエディタ「MapEditer」}

MapEditerはmobsim.mapediterに含まれる実行可能なJavaクラスである。
GUIによる直感的な操作が可能なシミュレーション補助ツールであり、
コマンドラインからは以下のように起動する。
%
\begin{center}
 \begin{tabular}{|l|}
 \hline
 ＞java\textvisiblespace mobsim.mapediter.MapEditer\textvisiblespace\\
 \hline
 \end{tabular}
\end{center}
%
本シミュレーションシステムでは地図データや空間的な分布データなど、
視覚的に確認しながら作業した方が直感的に扱いやすいデータを多く取り扱う必要がある。
そのため、図\ref{fig:SIMSYSTEM_MAPEDITER}に示すようなGUIベースでシミュレーションに必要なデータを編集したり、
シミュレーション実行時の様子を視覚的に表示することができるようなエディタを開発した。
本エディタの機能には以下のようなものがある。
%
\begin{itemize}
\item 地図画像からグラフ構造データ・町丁目行政界データを編集
\item 分布メッシュデータの編集
\item セルデータの編集
\item 領域データの編集
\item 地図データから経路情報データを自動生成する
\item 町丁目行政界データから分布メッシュを自動生成する
\item 経路探索のテスト
\item セル構造のボロノイ分割
\item シミュレーション実行時の視覚的表示
\item 呼損率・トラフィック量等のデータの視覚的表示
\end{itemize}
%
基本的な動作はマウスのみで行うことができ、
左クリックがメニューの選択や座標の決定などに用いられ、
右クリックが表示位置の調整に用いられる。
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.5}{\includegraphics{SIMSYSTEM_MAPEDITER.eps}}
 \caption{ MapEditer実行イメージ }
 \label{fig:SIMSYSTEM_MAPEDITER}
\end{center}
\end{figure}
\end{center}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.75}{\includegraphics{SIMSYSTEM_VIEWER_LAYER.eps}}
 \caption{ MapEditerの編集構造イメージ }
 \label{fig:SIMSYSTEM_VIEWER_LAYER}
\end{center}
\end{figure}
\end{center}
%
%

全ての機能はメニューから実行することができ、
「ファイル」「編集」「表示」「機能」の各機能については
表\ref{fig:SIMSYSTEM_FILEMENU}〜\ref{fig:SIMSYSTEM_FUNCMENU}にて示す。

また、MapEditerによるシミュレーション実行時の視覚的表示では
図\ref{fig:SIMSYSTEM_VIEWER_STA}のように駅での集団到着や、
図\ref{fig:SIMSYSTEM_VIEWER_SIG}のように交差点での混雑や待ちなどの影響を視覚的に
確認することができる。
%
%
\begin{table}
\begin{center}
\caption{ファイルメニュー機能一覧}
\begin{tabular}{|l|l|} \hline
	機能名 & 動作 \\\hline
	
	グラフ構造地図データ新規作成 &
	\begin{tabular}{l}
		現在編集中のグラフ構造地図データを破棄する。
	\end{tabular} \\\hline
	
	グラフ構造地図データ読込 &
	\begin{tabular}{l}
		ファイルからグラフ構造地図データを読み込む。
	\end{tabular} \\\hline
	
	グラフ構造地図データ書込 &
	\begin{tabular}{l}
		現在編集中のグラフ構造地図データをファイルに書き込む。
	\end{tabular} \\\hline
	
	分布メッシュデータ新規作成 &
	\begin{tabular}{l}
		現在編集中の分布メッシュデータを破棄する。
	\end{tabular} \\\hline
	
	分布メッシュデータデータ読込 &
	\begin{tabular}{l}
		ファイルから分布メッシュデータを読み込む。
	\end{tabular} \\\hline
	
	分布メッシュデータデータ書込 &
	\begin{tabular}{l}
		現在編集中の分布メッシュデータをファイルに書き込む。
	\end{tabular} \\\hline
	
	領域データ新規作成 &
	\begin{tabular}{l}
		現在編集中の領域データを破棄する。
	\end{tabular} \\\hline
	
	領域データ読込 &
	\begin{tabular}{l}
		ファイルから領域データを読み込む。
	\end{tabular} \\\hline
	
	領域データ書込 &
	\begin{tabular}{l}
		現在編集中の領域データをファイルに書き込む。
	\end{tabular} \\\hline
	
	セルデータ新規作成 &
	\begin{tabular}{l}
		現在編集中のグラフCellデータを破棄する。
	\end{tabular} \\\hline
	
	セルデータ読込 &
	\begin{tabular}{l}
		ファイルからセルデータを読み込む。
	\end{tabular} \\\hline
	
	セルデータ書込 &
	\begin{tabular}{l}
		現在編集中のセルデータをファイルに書き込む。
	\end{tabular} \\\hline
	
	背景画像設定 &
	\begin{tabular}{l}
		ファイルから地図画像等のJPEG形式画像データを読み込む。
	\end{tabular} \\\hline
	
\end{tabular}
\end{center}
\label{fig:SIMSYSTEM_FILEMENU}
\end{table}
%
%
\begin{table}
\begin{center}
\caption{編集メニュー機能一覧}
\begin{tabular}{|l|l|} \hline
	機能名 & 動作 \\\hline
	
	ノード追加 &
	\begin{tabular}{l}
		編集中のグラフ構造地図データにノードを追加する編集モードになる。\\
		マップ内で左クリックすることでその位置にノードを追加する。
	\end{tabular} \\\hline
	
	ノード編集 &
	\begin{tabular}{l}
		編集中のグラフ構造地図データのノードのデータを編集する\\
		編集モードになる。\\
		マップ内で左クリックによってノードを選択することで\\
		ノード情報の編集・削除を行う。
	\end{tabular} \\\hline
	
	エッジ追加 &
	\begin{tabular}{l}
		編集中のグラフ構造地図データにエッジを追加する編集モードになる。\\
		マップ内で左クリックによって任意のノードを2つ選択することによって\\
		エッジを追加する。
	\end{tabular} \\\hline
	
	エッジ編集 &
	\begin{tabular}{l}
		編集中のグラフ構造地図データのエッジのデータを編集する\\
		編集モードになる。\\
		マップ内で左クリックによってエッジを選択することで\\
		エッジ情報の編集・削除を行う。
	\end{tabular} \\\hline
	
	分布メッシュ値入力 &
	\begin{tabular}{l}
		編集中の分布メッシュデータに値を入力する編集モードになる。\\
		マップ内で左クリックによって任意のグリッドを選択することによって、\\
		その位置のデータを入力する。
	\end{tabular} \\\hline
	
	分布メッシュ設定 &
	\begin{tabular}{l}
		メッシュの起点や粒度などのデータを変更する。
	\end{tabular} \\\hline
	
	領域ノード追加 &
	\begin{tabular}{l}
		編集中の領域データに頂点ノードを入力する編集モードになる。\\
		マップ内で左クリックすることでその位置に\\
		頂点ノードを追加する。\\
	\end{tabular} \\\hline
	
	領域追加 &
	\begin{tabular}{l}
		編集中の領域データに多角形を追加する編集モードになる。\\
		マップ内で左クリックによって任意の頂点ノードを選択することによって\\
		始点と終点が一致したときに多角形が追加される。
	\end{tabular} \\\hline
	
	領域データ設定 &
	\begin{tabular}{l}
		編集中の領域データ上の多角形にデータを入力する編集モードになる。\\
		マップ内で左クリックによって多角形を選択することによって\\
		データ入力を行うことができる。
	\end{tabular} \\\hline
	
	セル追加 &
	\begin{tabular}{l}
		編集中のセルデータにセルを追加する編集モードになる。\\
		マップ内で左クリックすることによってセルを追加する。
	\end{tabular} \\\hline
	
	セル編集 &
	\begin{tabular}{l}
		編集中のセルデータを編集する編集モードになる。\\
		マップ内で左クリックによってセルの中心を選択することによって\\
		セルの編集・削除を行うことができる。。
	\end{tabular} \\\hline
	
	編集設定 &
	\begin{tabular}{l}
		地図データ・背景データなどの表示倍率の変更や、\\
		追加するエッジのタイプ番号の初期値を設定することができる。
	\end{tabular} \\\hline
	
\end{tabular}
\end{center}
\end{table}
%
%
\begin{table}
\begin{center}
\caption{表示メニュー機能一覧}
\begin{tabular}{|l|l|} \hline
	機能名 & 動作 \\\hline
	
	\begin{tabular}{l}
		ホーム
	\end{tabular} 
	&
	\begin{tabular}{l}
		表示座標の起点を(0,0)にあわせる。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		グラフ構造地図データ\\
		表示/非表示
	\end{tabular} 
	&
	\begin{tabular}{l}
		現在編集中のグラフ構造地図データの表示・非表示を切り替える。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		分布メッシュ表示/非表示
	\end{tabular} 
	&
	\begin{tabular}{l}
		現在編集中の分布メッシュデータの表示・非表示を切り替える。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		背景表示/非表示
	\end{tabular} 
	&
	\begin{tabular}{l}
		現在表示中の背景画像の表示・非表示を切り替える。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		領域表示/非表示
	\end{tabular} 
	&
	\begin{tabular}{l}
		現在編集中の領域データの表示・非表示を切り替える。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		セルデータ表示/非表示
	\end{tabular} 
	&
	\begin{tabular}{l}
		現在編集中のセルデータの表示・非表示を切り替える。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		マーカー表示サイズ大小
	\end{tabular} 
	&
	\begin{tabular}{l}
		シミュレーション状態表示時の利用者の位置を表す赤い点の\\
		大きさを切り替える。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		ノード表示サイズ大小
	\end{tabular} 
	&
	\begin{tabular}{l}
		グラフ構造地図データのノード表示の大きさを切り替える。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		エッジ幅表示
	\end{tabular} 
	&
	\begin{tabular}{l}
		エッジの幅によってエディタ上に表示する線の太さを変化させる。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		背景色変更(白/黒)
	\end{tabular} 
	&
	\begin{tabular}{l}
		背景色の白黒を切り替える。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		領域濃淡色変更(赤/青)
	\end{tabular} 
	&
	\begin{tabular}{l}
		分布データ表示時などの領域データのグラデーション表示の\\
		色を切り替える。
	\end{tabular} \\\hline
	
\end{tabular}
\end{center}
\end{table}
%
%
\begin{table}
\begin{center}
\caption{機能メニュー機能一覧}
\begin{tabular}{|l|l|} \hline
	機能名 & 動作 \\\hline
	
	\begin{tabular}{l}
		経路情報データ生成
	\end{tabular}
	&
	\begin{tabular}{l}
		現在編集中のグラフ構造地図データの経路情報データを生成する。\\
		メモリ上に生成されるため、シミュレーションに用いるためには、\\
		ファイルに書き込む必要がある。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		経路情報データ生成\\
		(マルチスレッド)
	\end{tabular}
	&
	\begin{tabular}{l}
		RoutingTable生成をマルチスレッドで実行する。\\
		マルチプロセッサマシンなどではこちらのほうが高速な場合もある。\\
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		経路探索テスト
	\end{tabular}
	&
	\begin{tabular}{l}
		ノード間の最短経路を探索する。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		経路探索テスト２
	\end{tabular}
	&
	\begin{tabular}{l}
		感度パラメータによる経路選択行動の変化を調査する機能。\\
		地図データ上の2ノードを選択し、\\
		感度パラメータを設定することによって実行される。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		領域データから\\
		分布メッシュデータ生成
	\end{tabular}
	&
	\begin{tabular}{l}
		多角形の集合である領域データから\\
		メッシュ構造の分布データを生成する。\\
		メッシュデータはメモリ上に生成されるため、\\
		シミュレーションに用いるためには、\\
		ファイルに書き込む必要がある。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		エッジ付加データ全消去
	\end{tabular}
	&
	\begin{tabular}{l}
		「経路探索テスト２」等ではエッジへのデータ格納が行われる。\\
		それらのデータを消去して表示上の変化を元に戻す。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		セル配置ボロノイ分割
	\end{tabular}
	&
	\begin{tabular}{l}
		現在編集中のセルデータのセル配置によって\\
		構成されるボロノイ分割を領域データとして生成する。\\
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		エッジ分割
	\end{tabular}
	&
	\begin{tabular}{l}
		選択したエッジを指定した長さで分割する。\\
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		領域データ一括入力
	\end{tabular}
	&
	\begin{tabular}{l}
		タブ区切りのCSVデータを領域データに一括入力する。\\
		セル構造の領域データに性能評価データなどの\\
		CSV形式データを設定する時に使用する。\\
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		グラフ構造地図データ\\
		一括変換
	\end{tabular}
	 &
	\begin{tabular}{l}
		グラフ構造地図データ全体をxy座標軸方向それぞれに、\\
		シフト・伸縮を行う。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		領域データ一括変換
	\end{tabular}
	&
	\begin{tabular}{l}
		領域データ全体をxy座標軸方向それぞれに、\\
		シフト・伸縮を行う。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		セルデータ一括変換
	\end{tabular}
	&
	\begin{tabular}{l}
		セルデータ全体をxy座標軸方向それぞれに、\\
		シフト・伸縮を行う。
	\end{tabular} \\\hline
	
	\begin{tabular}{l}
		シミュレーション実行
	\end{tabular}
	&
	\begin{tabular}{l}
		シミュレーションを視覚的表現を行いながら実行する。\\
		実行するシナリオファイルを選択することによって、\\
		シミュレーションが実行される。
	\end{tabular} \\\hline
	
\end{tabular}
\end{center}
\label{fig:SIMSYSTEM_FUNCMENU}
\end{table}
%
%
\begin{center}
\begin{figure}
\begin{center}
 \scalebox{0.5}{\includegraphics{SIMSYSTEM_VIEWER.eps}}
 \caption{ 視覚的表現 }
 \label{fig:SIMSYSTEM_VIEWER}
\end{center}
\end{figure}
\end{center}
%
%
\begin{figure}
\begin{center}
 \begin{tabular}{c c}
 
  \scalebox{0.65}{\includegraphics{SIMSYSTEM_VIEWER_STA_A.eps}} &
  \scalebox{0.65}{\includegraphics{SIMSYSTEM_VIEWER_STA_B.eps}} \\
 
  (a) 電車到着前 &
  (b) 電車到着直後 \\

 \end{tabular}
\end{center}
 \caption{視覚的表現（駅での集団到着）}
 \label{fig:SIMSYSTEM_VIEWER_STA}
\end{figure}
%
%
\begin{figure}
\begin{center}
 \begin{tabular}{c c}
 
  \scalebox{0.6}{\includegraphics{SIMSYSTEM_VIEWER_SIG_A.eps}} &
  \scalebox{0.6}{\includegraphics{SIMSYSTEM_VIEWER_SIG_B.eps}} \\
 
  (a) 信号：赤 &
  (b) 信号：青 \\

 \end{tabular}
\end{center}
 \caption{視覚的表現（スクランブル交差点）}
 \label{fig:SIMSYSTEM_VIEWER_SIG}
\end{figure}
%
%


\subsubsection*{性能評価データ抽出ツール「SimDataConv」}

SimDataConvはシミュレーション結果として出力されたデータから
セル毎のトラフィック量・呼損データ・
M/M/k/kモデルによって見積もった呼損率データ等を抽出・計算するツールであり、
mobsim.toolsパッケージに含まれる実行可能なJavaクラスである。
コマンドラインからの実行は以下のように行う。
%
%
\begin{center}
 \begin{tabular}{|l|}
 \hline
 ＞java\textvisiblespace mobsim.tools.SimDataConv\textvisiblespace ［出力データ］\textvisiblespace［抽出開始時刻］-［抽出終了時刻］\\
 \hline
 \end{tabular}
\end{center}
%
%
本ツールでは抽出開始時刻を設定することができるため、
定常になっていない状態の結果を無視することが可能である。
［抽出開始時刻］［抽出終了時刻］は省略することもできる。
性能評価データファイルは実行後にカレントディレクトリに生成される。


\subsection*{シミュレーション実行環境と実行時間について}

本論文で示したシミュレーション結果を計算した
計算機環境を表 \ref{fig:SIMSYSTEM_ENV} に示す。
シミュレーションエリアに平均6000人程度の利用者が存在する状況を
13時間のシミュレーションを行った場合、
計算にかかった時間はおよそ9.3時間であった。
%
%
\begin{table}[htbp]
\begin{center}
\caption{ シミュレーション実行環境 }
\begin{tabular}{|l|l|} \hline
PC & Dell Optiplex GX260
（CPU Pentium4 2.4 GHz,メモリ 512MB） \\\hline
OS & Windows2000 \\\hline
Java & J2SDK 1.4.2.03 \\\hline
\end{tabular}
\end{center}
\label{fig:SIMSYSTEM_ENV}
\end{table}
%
%


\newpage
\section*{AppendixB 性能評価データ}

\subsection*{ $ \lambda_p × 1.0 $ 再呼あり の場合}


\end{document}
